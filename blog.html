<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, viewport-fit=cover">
<title>Ø§Ù„Ù…Ø¯ÙˆÙ†Ø© Ø§Ù„Ø·Ø¨ÙŠØ©</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<!-- Ø§Ø³ØªÙŠØ±Ø§Ø¯ Supabase SDK -->
<script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

    // ğŸ”— Ø±Ø§Ø¨Ø· Ù…Ø´Ø±ÙˆØ¹Ùƒ
    const supabaseUrl = "https://gxuumjhtutkipvkljjhj.supabase.co";
    // ğŸ”‘ Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø¹Ø§Ù… (anon key)
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd4dXVtamh0dXRraXB2a2xqamhqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU1NTM2MzEsImV4cCI6MjA4MTEyOTYzMX0.rmsSRTQ57cAJ3VAiQMe0mdxEYcERh6zQDep7DN_frFI";

    // ğŸ“¦ Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù…ÙŠÙ„ Supabase
    window.supabase = createClient(supabaseUrl, supabaseKey);
</script>

<style>
:root {
    --medical-primary: #009688;
    --medical-light: #4DB6AC;
    --medical-dark: #00695C;
    --card-bg: rgba(255, 255, 255, 0.95);
    --shadow-light: 0 4px 15px rgba(0, 150, 136, 0.1);
    --shadow-hover: 0 8px 25px rgba(0, 150, 136, 0.2);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Cairo', sans-serif;
}

body {
    background: linear-gradient(135deg, #f4f8f9 0%, #e8f4f5 100%);
    min-height: 100vh;
    padding-bottom: 60px;
    position: relative;
    overflow-x: hidden;
}

/* ØªØ£Ø«ÙŠØ± Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø·Ø¨ÙŠØ© */
body::before {
    content: '';
    position: fixed;
    top: 0;
    right: 0;
    width: 100%;
    height: 100%;
    background-image: 
        radial-gradient(circle at 20% 80%, rgba(0, 150, 136, 0.08) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(77, 182, 172, 0.06) 0%, transparent 50%);
    z-index: -1;
}

/* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ù…ØªØ·ÙˆØ± */
header {
    background: linear-gradient(135deg, var(--medical-primary), var(--medical-dark));
    color: white;
    text-align: center;
    padding: 25px 20px;
    font-size: clamp(26px, 5vw, 32px);
    font-weight: 900;
    box-shadow: 0 6px 20px rgba(0, 105, 92, 0.3);
    position: relative;
    overflow: hidden;
}

header::before {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
    animation: shimmer 3s infinite;
}

@keyframes shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
}

.header-icon {
    margin-left: 15px;
    font-size: 34px;
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
}

/* Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© Ø§Ù„Ù…ØªØ·ÙˆØ± */
.back-btn {
    display: block;
    width: fit-content;
    margin: 25px auto 20px;
    padding: 14px 28px;
    background: linear-gradient(135deg, var(--medical-dark), var(--medical-primary));
    color: white;
    font-size: 18px;
    text-decoration: none;
    border-radius: 50px;
    font-weight: 700;
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    box-shadow: 0 4px 15px rgba(0, 105, 92, 0.3);
    border: 2px solid rgba(255, 255, 255, 0.2);
    display: flex;
    align-items: center;
    gap: 10px;
    position: relative;
    overflow: hidden;
}

.back-btn::before {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), transparent);
    z-index: 1;
}

.back-btn:hover {
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 8px 25px rgba(0, 105, 92, 0.4);
    background: linear-gradient(135deg, var(--medical-primary), var(--medical-dark));
}

.back-btn:active {
    transform: translateY(-1px) scale(1.02);
}

.back-btn i {
    font-size: 20px;
}

/* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
main {
    max-width: 1000px;
    margin: 0 auto;
    padding: 20px;
}

/* Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
.loading-container {
    text-align: center;
    margin: 50px 0;
}

.loading-spinner {
    width: 50px;
    height: 50px;
    border: 4px solid rgba(0, 150, 136, 0.2);
    border-radius: 50%;
    border-top-color: var(--medical-primary);
    animation: spin 1s linear infinite;
    margin: 0 auto 20px;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.loading-text {
    color: var(--medical-dark);
    font-size: 18px;
    font-weight: 600;
}

.empty-state {
    text-align: center;
    padding: 60px 20px;
    color: #666;
    background: var(--card-bg);
    border-radius: 20px;
    box-shadow: var(--shadow-light);
    margin: 30px auto;
    max-width: 600px;
}

.empty-icon {
    font-size: 60px;
    color: var(--medical-light);
    margin-bottom: 20px;
}

.empty-state h3 {
    color: var(--medical-dark);
    font-size: 24px;
    margin-bottom: 15px;
    font-weight: 800;
}

.empty-state p {
    font-size: 18px;
    line-height: 1.6;
    color: #777;
}

/* ÙƒØ±ÙˆØª Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª */
.blog-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 25px;
    margin-top: 20px;
}

.blog-card {
    background: var(--card-bg);
    border-radius: 20px;
    overflow: hidden;
    box-shadow: var(--shadow-light);
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    cursor: pointer;
    position: relative;
    border: 1px solid rgba(0, 150, 136, 0.1);
}

.blog-card:hover {
    transform: translateY(-8px);
    box-shadow: var(--shadow-hover);
    border-color: rgba(0, 150, 136, 0.2);
}

.blog-card:hover .card-image {
    transform: scale(1.05);
}

/* ØµÙˆØ±Ø© Ø§Ù„Ù…Ù‚Ø§Ù„ */
.card-image-container {
    width: 100%;
    height: 220px;
    overflow: hidden;
    position: relative;
}

.card-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
}

.image-placeholder {
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, var(--medical-light), var(--medical-primary));
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
}

.image-placeholder i {
    font-size: 50px;
    opacity: 0.8;
}

/* Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙƒØ§Ø±Øª */
.card-content {
    padding: 25px;
}

.card-title {
    font-size: clamp(20px, 4vw, 24px);
    color: var(--medical-dark);
    margin-bottom: 12px;
    font-weight: 800;
    line-height: 1.4;
    min-height: 68px;
    display: flex;
    align-items: center;
}


/* Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù‚Ø§Ù„ */
.card-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 20px;
    padding-top: 18px;
    border-top: 1px solid rgba(0, 150, 136, 0.1);
}

.card-date {
    color: var(--medical-primary);
    font-size: 14px;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 8px;
}

.card-date i {
    font-size: 16px;
}

.card-category {
    background: rgba(0, 150, 136, 0.1);
    color: var(--medical-dark);
    padding: 6px 15px;
    border-radius: 50px;
    font-size: 13px;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 6px;
}

/* Ø²Ø± Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© */
.read-more {
    background: linear-gradient(135deg, var(--medical-primary), var(--medical-dark));
    color: white;
    padding: 10px 20px;
    border-radius: 50px;
    font-size: 15px;
    font-weight: 700;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s ease;
    border: none;
    cursor: pointer;
    margin-top: 15px;
}

.read-more:hover {
    transform: translateX(-5px);
    box-shadow: 0 4px 15px rgba(0, 150, 136, 0.3);
}

/* ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø¬ÙˆØ§Ù„ */
.blog-card:active {
    transform: scale(0.98);
}

/* Ø§Ù„ÙÙˆØªØ± */
footer {
    text-align: center;
    padding: 25px 20px;
    color: #666;
    font-size: 15px;
    margin-top: 40px;
    border-top: 1px solid rgba(0, 150, 136, 0.1);
}

.footer-content {
    max-width: 800px;
    margin: 0 auto;
}

.copyright {
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px solid rgba(0, 150, 136, 0.05);
    font-size: 14px;
    opacity: 0.8;
}

/* ØªØ£Ø«ÙŠØ±Ø§Øª Ø¯Ø®ÙˆÙ„ Ø§Ù„ÙƒØ±ÙˆØª */
@keyframes cardEntry {
    0% { opacity: 0; transform: translateY(30px); }
    100% { opacity: 1; transform: translateY(0); }
}

.blog-card {
    animation: cardEntry 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
    opacity: 0;
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø¬ÙˆØ§Ù„ */
@media (max-width: 767px) {
    main {
        padding: 15px;
    }
    
    .back-btn {
        margin: 20px auto 15px;
        padding: 12px 24px;
        font-size: 16px;
    }
    
    .blog-grid {
        gap: 20px;
    }
    
    .card-image-container {
        height: 180px;
    }
    
    .card-content {
        padding: 20px;
    }
    
    .card-title {
        min-height: auto;
        margin-bottom: 10px;
    }
    
    
    .card-meta {
        flex-direction: column;
        gap: 10px;
        align-items: flex-start;
    }
}

@media (min-width: 768px) {
    .blog-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (min-width: 1024px) {
    .blog-grid {
        grid-template-columns: repeat(3, 1fr);
    }
}

@media (prefers-reduced-motion: reduce) {
    * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
}
</style>
</head>

<body>

<header>
    <i class="fas fa-book-medical header-icon"></i>
    ğŸ“˜ Ø§Ù„Ù…Ø¯ÙˆÙ†Ø© Ø§Ù„Ø·Ø¨ÙŠØ©
</header>

<a class="back-btn" href="index.html">
    <i class="fas fa-arrow-right"></i>
    Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
</a>

<main>
    <div id="loading" class="loading-container">
        <div class="loading-spinner"></div>
        <p class="loading-text">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª...</p>
    </div>
    
    <div id="blog-container" class="blog-grid"></div>
    
    <div id="empty-state" class="empty-state" style="display: none;">
        <div class="empty-icon">
            <i class="fas fa-newspaper"></i>
        </div>
        <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‚Ø§Ù„Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</h3>
        <p>Ù„Ù… ÙŠØªÙ… Ù†Ø´Ø± Ø£ÙŠ Ù…Ù‚Ø§Ù„Ø§Øª Ø·Ø¨ÙŠØ© Ø¨Ø¹Ø¯. ØªØ§Ø¨Ø¹Ù†Ø§ Ù‚Ø±ÙŠØ¨Ø§Ù‹ Ù„Ù…Ø­ØªÙˆÙ‰ Ø·Ø¨ÙŠ Ù…ÙÙŠØ¯.</p>
    </div>
</main>

<footer>
    <div class="footer-content">
        <p>Ù…ØµØ¯Ø± Ù…ÙˆØ«ÙˆÙ‚ Ù„Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ© ÙˆØ§Ù„ØªÙˆØ¹ÙŠØ© Ø§Ù„ØµØ­ÙŠØ©</p>
        <div class="copyright">
            Â© 2025 - Ø§Ù„Ù…Ø¯ÙˆÙ†Ø© Ø§Ù„Ø·Ø¨ÙŠØ© | Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©
        </div>
    </div>
</footer>

<script>
document.addEventListener('DOMContentLoaded', async function() {
    const container = document.getElementById('blog-container');
    const loading = document.getElementById('loading');
    const emptyState = document.getElementById('empty-state');
    
    // Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ Supabase
    await waitForSupabase();
    
    async function loadBlogs() {
        try {
            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„ÙØ§Ø±ØºØ© Ù…Ø¤Ù‚ØªØ§Ù‹
            emptyState.style.display = 'none';
            
            if (!window.supabase) {
                throw new Error('Supabase ØºÙŠØ± Ù…ØªÙˆÙØ±');
            }
            
            // Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª Ù…Ù† Supabase
            const { data: blogs, error } = await window.supabase
                .from('blog')
                .select('*')
                .order('created_at', { ascending: false });
            
            // Ø¥Ø®ÙØ§Ø¡ Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
            loading.style.display = 'none';
            
            if (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª:', error);
                showEmptyState('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª');
                return;
            }
            
            if (!blogs || blogs.length === 0) {
                showEmptyState('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‚Ø§Ù„Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹');
                return;
            }
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª
            container.innerHTML = '';
            
            blogs.forEach((blog, index) => {
                const card = createBlogCard(blog, index);
                container.appendChild(card);
            });
            
        } catch (error) {
            console.error('Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹:', error);
            loading.style.display = 'none';
            showEmptyState('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª');
        }
    }
    
    function createBlogCard(blog, index) {
        const card = document.createElement('div');
        card.className = 'blog-card';
        
        // ØªØ£Ø®ÙŠØ± Ø¸Ù‡ÙˆØ± Ø§Ù„ÙƒØ±ÙˆØª
        card.style.animationDelay = `${index * 0.1}s`;
        
        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        const title = blog.title || 'Ù…Ù‚Ø§Ù„ Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†';
        const content = blog.content || blog.short || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø­ØªÙˆÙ‰';
        const imageUrl = blog.image_url || blog.img || null;
        const date = blog.created_at ? formatDate(blog.created_at) : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
        const category = blog.category || 'Ø¹Ø§Ù…';
        const id = blog.id;
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙƒØ§Ø±Øª
        card.innerHTML = `
            <div class="card-image-container">
                ${imageUrl ? 
                    `<img src="${imageUrl}" alt="${title}" class="card-image" loading="lazy">` :
                    `<div class="image-placeholder">
                        <i class="fas fa-stethoscope"></i>
                    </div>`
                }
            </div>
            <div class="card-content">
                <h3 class="card-title">${title}</h3>
                <p class="card-excerpt">${truncateText(content, 150)}</p>
                <div class="card-meta">
                    <span class="card-date">
                        <i class="far fa-calendar"></i>
                        ${date}
                    </span>
                    <span class="card-category">
                        <i class="fas fa-tag"></i>
                        ${category}
                    </span>
                </div>
                <button class="read-more" onclick="viewBlog('${id}')">
                    Ø§Ù‚Ø±Ø£ Ø§Ù„Ù…Ø²ÙŠØ¯
                    <i class="fas fa-arrow-left"></i>
                </button>
            </div>
        `;
        
        // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„ÙƒØ§Ø±Øª ÙƒÙ„Ù‡
        card.addEventListener('click', (e) => {
            if (!e.target.closest('.read-more')) {
                viewBlog(id);
            }
        });
        
        return card;
    }
    
    function showEmptyState(message) {
        emptyState.style.display = 'block';
        emptyState.querySelector('h3').textContent = message;
    }
    
    function formatDate(dateString) {
        try {
            const date = new Date(dateString);
            return date.toLocaleDateString('ar-EG', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        } catch (error) {
            return 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
        }
    }
    
    function truncateText(text, maxLength) {
        if (text.length <= maxLength) return text;
        return text.substring(0, maxLength) + '...';
    }
    
    async function waitForSupabase() {
        let attempts = 0;
        const maxAttempts = 10;
        
        return new Promise((resolve, reject) => {
            const checkSupabase = () => {
                attempts++;
                if (window.supabase) {
                    resolve();
                } else if (attempts >= maxAttempts) {
                    reject(new Error('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Supabase'));
                } else {
                    setTimeout(checkSupabase, 500);
                }
            };
            checkSupabase();
        });
    }
    
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª
    await loadBlogs();
});

// Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù‚Ø§Ù„
function viewBlog(id) {
    window.location.href = `blog-view.html?id=${id}`;
}
</script>

</body>
</html>