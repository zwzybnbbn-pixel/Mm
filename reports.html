<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ“ Ù†Ø¸Ø§Ù… Ø¥Ø¨Ù„Ø§Øº Ø§Ù†Ù‚Ø·Ø§Ø¹ Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡</title>

<!-- ØªØ­Ù…ÙŠÙ„ Supabase Ù…Ø¨Ø§Ø´Ø±Ø© (Ø¨Ø¯ÙˆÙ† import) -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>

<!-- Ø§Ù„Ø®Ø·ÙˆØ· -->
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: 'Cairo', sans-serif;
}

body {
  background: linear-gradient(135deg, #0a0a0a 0%, #111 50%, #1a1a1a 100%);
  min-height: 100vh;
  color: #e6edf3;
  padding: 15px;
  line-height: 1.6;
}

.container {
  max-width: 700px;
  margin: 0 auto;
}

.card {
  background: rgba(255, 255, 255, 0.06);
  padding: 25px;
  border-radius: 20px;
  margin-bottom: 25px;
  backdrop-filter: blur(10px);
  border: 1px solid #30363d;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
  transition: all 0.3s ease;
}

.card:hover {
  border-color: rgba(31, 111, 235, 0.3);
  box-shadow: 0 12px 40px rgba(31, 111, 235, 0.2);
}

.title {
  text-align: center;
  font-size: 28px;
  font-weight: 800;
  margin: 20px 0 30px;
  color: #fff;
  position: relative;
  padding-bottom: 15px;
}

.title::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 150px;
  height: 3px;
  background: linear-gradient(90deg, #1f6feb, #4db8ff);
  border-radius: 3px;
}

.form-header {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 20px;
  padding-bottom: 15px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.input-group {
  margin-bottom: 20px;
}

.input-group label {
  display: block;
  font-weight: 600;
  margin-bottom: 8px;
  font-size: 16px;
  color: #d0d7de;
}

.input-group input,
.input-group textarea,
.input-group select {
  width: 100%;
  padding: 14px 16px;
  font-size: 16px;
  border-radius: 12px;
  border: 2px solid #30363d;
  background: rgba(22, 27, 34, 0.8);
  color: #e6edf3;
  transition: all 0.3s ease;
}

.input-group input:focus,
.input-group textarea:focus,
.input-group select:focus {
  outline: none;
  border-color: #1f6feb;
  box-shadow: 0 0 0 3px rgba(31, 111, 235, 0.2);
}

.btn-submit {
  width: 100%;
  background: linear-gradient(135deg, #1f6feb, #0d5bc0);
  padding: 16px;
  border-radius: 12px;
  color: white;
  font-size: 18px;
  font-weight: 700;
  border: none;
  cursor: pointer;
  transition: all 0.3s ease;
  margin-top: 10px;
}

.btn-submit:hover:not(:disabled) {
  background: linear-gradient(135deg, #0d5bc0, #1f6feb);
  transform: translateY(-2px);
}

.btn-submit:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

#reportsList {
  margin-top: 20px;
}

.report-item {
  background: rgba(255, 255, 255, 0.05);
  padding: 20px;
  border-radius: 16px;
  margin-bottom: 15px;
  border: 1px solid #30363d;
}

.report-item strong {
  color: #4db8ff;
  display: block;
  margin-bottom: 5px;
}

.loader {
  border: 4px solid rgba(255, 255, 255, 0.1);
  border-top: 4px solid #1f6feb;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  animation: spin 1s linear infinite;
  margin: 20px auto;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.error-message {
  background: rgba(231, 76, 60, 0.1);
  border: 1px solid #e74c3c;
  color: #ff6b6b;
  padding: 15px;
  border-radius: 10px;
  text-align: center;
  margin: 20px 0;
}

.success-message {
  background: rgba(46, 204, 113, 0.1);
  border: 1px solid #2ecc71;
  color: #2ecc71;
  padding: 15px;
  border-radius: 10px;
  text-align: center;
  margin: 20px 0;
}
</style>

<!-- Ø±Ø¤ÙˆØ³ Ø§Ù„Ø£Ù…Ø§Ù† Ù…ØªÙˆØ§ÙÙ‚Ø© Ù…Ø¹ vercel.json -->
<meta http-equiv="Content-Security-Policy" content="
  default-src 'self' https: data:;
  script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://*.supabase.co;
  style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com;
  font-src 'self' data: https://fonts.gstatic.com;
  connect-src 'self' https://*.supabase.co wss://*.supabase.co https:;
  img-src 'self' data: https:;
  frame-src 'self' https:;
">

<meta http-equiv="X-Content-Type-Options" content="nosniff">
<meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
<meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
</head>
<body>

<div class="container">
  <h1 class="title">ğŸ“ Ù†Ø¸Ø§Ù… Ø¥Ø¨Ù„Ø§Øº Ø§Ù†Ù‚Ø·Ø§Ø¹ Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡</h1>
  
  <!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¥Ø¨Ù„Ø§Øº -->
  <div class="card">
    <div class="form-header">
      <i class="fas fa-exclamation-triangle"></i>
      <h2>Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù„Ø§Øº Ø¬Ø¯ÙŠØ¯</h2>
    </div>
    
    <form id="reportForm">
      <div class="input-group">
        <label><i class="fas fa-bolt"></i> Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©</label>
        <select id="type" required>
          <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©</option>
          <option value="Ø§Ù†Ù‚Ø·Ø§Ø¹ ÙƒØ§Ù…Ù„">Ø§Ù†Ù‚Ø·Ø§Ø¹ ÙƒØ§Ù…Ù„</option>
          <option value="Ø§Ù†Ø®ÙØ§Ø¶ Ø§Ù„Ø¬Ù‡Ø¯">Ø§Ù†Ø®ÙØ§Ø¶ Ø§Ù„Ø¬Ù‡Ø¯</option>
          <option value="ÙˆÙ…ÙŠØ¶ Ù…Ø³ØªÙ…Ø±">ÙˆÙ…ÙŠØ¶ Ù…Ø³ØªÙ…Ø±</option>
          <option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option>
        </select>
      </div>
      
      <div class="input-group">
        <label><i class="fas fa-user"></i> Ø§Ù„Ø§Ø³Ù…</label>
        <input type="text" id="name" required placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ">
      </div>
      
      <div class="input-group">
        <label><i class="fas fa-phone"></i> Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
        <input type="tel" id="phone" pattern="[0-9]{9,10}" placeholder="777777777" required>
      </div>
      
      <div class="input-group">
        <label><i class="fas fa-map-marker-alt"></i> Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</label>
        <input type="text" id="location" required placeholder="Ù…Ø«Ø§Ù„: ÙˆØ³Ø· Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©">
      </div>
      
      <div class="input-group">
        <label><i class="fas fa-info-circle"></i> Ø§Ù„ØªÙØ§ØµÙŠÙ„</label>
        <textarea id="details" required placeholder="ØµÙ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø¨Ø§Ù„ØªÙØµÙŠÙ„" rows="4"></textarea>
      </div>
      
      <button type="submit" class="btn-submit" id="submitBtn">
        <i class="fas fa-paper-plane"></i> Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ù„Ø§Øº
      </button>
    </form>
  </div>
  
  <!-- ÙØ§ØµÙ„ -->
  <div style="text-align:center; margin:30px 0; color:#666; font-size:14px;">
    <i class="fas fa-list"></i> Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
  </div>
  
  <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª -->
  <div class="card">
    <h2 style="margin-bottom:15px;"><i class="fas fa-clipboard-list"></i> Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</h2>
    <div id="reportsList">
      <div class="loader"></div>
      <p style="text-align:center; opacity:0.7;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª...</p>
    </div>
  </div>
</div>

<!-- Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ -->
<div id="alerts" style="position:fixed; top:20px; right:20px; z-index:1000;"></div>

<script>
// ==================== Ø¥Ø¹Ø¯Ø§Ø¯ Supabase ====================

// Ø¨ÙŠØ§Ù†Ø§Øª Supabase Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ
const SUPABASE_CONFIG = {
    url: 'https://gxuumjhtutkipvkljjhj.supabase.co',
    key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd4dXVtamh0dXRraXB2a2xqamhqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU1NTM2MzEsImV4cCI6MjA4MTEyOTYzMX0.rmsSRTQ57cAJ3VAiQMe0mdxEYcERh6zQDep7DN_frFI'
};

// ØªØ­Ù…ÙŠÙ„ Supabase ÙˆØªØ£ÙƒØ¯ Ù…Ù† ØµØ­ØªÙ‡
function initializeSupabase() {
    console.log('ğŸ”„ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Supabase...');
    
    if (!window.supabase || !window.supabase.createClient) {
        console.error('âŒ Ù…ÙƒØªØ¨Ø© Supabase ØºÙŠØ± Ù…Ø­Ù…Ù„Ø©');
        showAlert('Ø®Ø·Ø£: Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø§ØªØµØ§Ù„ ØºÙŠØ± Ù…Ø­Ù…Ù„Ø©', 'error');
        return null;
    }
    
    try {
        const { createClient } = window.supabase;
        const supabase = createClient(SUPABASE_CONFIG.url, SUPABASE_CONFIG.key);
        console.log('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù…ÙŠÙ„ Supabase');
        return supabase;
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¹Ù…ÙŠÙ„:', error);
        showAlert('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
        return null;
    }
}

// ==================== Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ====================

// Ø¹Ø±Ø¶ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡
function showAlert(message, type = 'info') {
    const alertsDiv = document.getElementById('alerts');
    const alert = document.createElement('div');
    
    alert.className = type === 'error' ? 'error-message' : 'success-message';
    alert.style.marginBottom = '10px';
    alert.style.padding = '12px 20px';
    alert.style.borderRadius = '8px';
    alert.style.animation = 'fadeIn 0.3s ease';
    alert.innerHTML = `<i class="fas fa-${type === 'error' ? 'exclamation-circle' : 'check-circle'}"></i> ${message}`;
    
    alertsDiv.appendChild(alert);
    
    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†ÙŠ
    setTimeout(() => {
        if (alert.parentNode) {
            alert.style.opacity = '0';
            alert.style.transition = 'opacity 0.5s ease';
            setTimeout(() => alert.remove(), 500);
        }
    }, 5000);
}

// ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù†Øµ Ø¶Ø¯ XSS
function sanitizeText(text) {
    if (!text) return '';
    
    // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± Ù†ØµÙŠ Ø¢Ù…Ù†
    const div = document.createElement('div');
    div.textContent = String(text);
    
    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¶Ø§Ø±
    const cleanText = div.innerHTML
        .replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '')
        .replace(/javascript:/gi, '')
        .replace(/on\w+\s*=/gi, '')
        .replace(/data:/gi, '');
    
    return cleanText;
}

// ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ®
function formatDate(dateString) {
    if (!dateString) return 'â€”';
    
    try {
        const date = new Date(dateString);
        if (isNaN(date.getTime())) return 'â€”';
        
        return date.toLocaleString('ar-EG', {
            year: 'numeric',
            month: 'long',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
        });
    } catch (error) {
        return 'â€”';
    }
}

// ==================== ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª ====================

async function loadReports() {
    const reportsDiv = document.getElementById('reportsList');
    
    try {
        // ØªÙ‡ÙŠØ¦Ø© Supabase
        const supabase = initializeSupabase();
        if (!supabase) {
            reportsDiv.innerHTML = '<div class="error-message">âŒ ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…</div>';
            return;
        }
        
        console.log('ğŸ“¡ Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
        
        // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø¬Ø¯ÙˆÙ„ 'reports'
        const { data: reports, error } = await supabase
            .from('reports')
            .select('*')
            .order('created_at', { ascending: false })
            .limit(20);
        
        if (error) {
            console.error('âŒ Ø®Ø·Ø£ Ù…Ù† Supabase:', error);
            reportsDiv.innerHTML = `
                <div class="error-message">
                    <p>âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>
                    <small>${error.message}</small>
                </div>
            `;
            return;
        }
        
        console.log(`âœ… ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… ${reports?.length || 0} Ø¨Ù„Ø§Øº`);
        
        // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        if (!reports || reports.length === 0) {
            reportsDiv.innerHTML = `
                <div style="text-align:center; padding:40px; color:#888;">
                    <i class="far fa-folder-open" style="font-size:48px; margin-bottom:15px;"></i>
                    <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ù„Ø§ØºØ§Øª Ù…Ø³Ø¬Ù„Ø©</p>
                    <small style="color:#666;">ÙƒÙ† Ø£ÙˆÙ„ Ù…Ù† ÙŠØ¨Ù„Øº Ø¹Ù† Ù…Ø´ÙƒÙ„Ø©</small>
                </div>
            `;
            return;
        }
        
        // Ø¨Ù†Ø§Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª
        let html = '';
        reports.forEach((report, index) => {
            // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            const cleanReport = {
                id: sanitizeText(report.id || ''),
                name: sanitizeText(report.name || 'ØºÙŠØ± Ù…Ø°ÙƒÙˆØ±'),
                type: sanitizeText(report.type || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'),
                location: sanitizeText(report.location || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'),
                phone: sanitizeText(report.phone || 'ØºÙŠØ± Ù…Ø°ÙƒÙˆØ±'),
                details: sanitizeText(report.details || 'Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙØ§ØµÙŠÙ„'),
                status: sanitizeText(report.status || 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©'),
                reply: sanitizeText(report.reply || ''),
                created_at: report.created_at
            };
            
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ø²Ø¡ Ù…Ù† Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ
            if (cleanReport.phone.length > 3) {
                cleanReport.phone = cleanReport.phone.substring(0, 3) + '******';
            }
            
            const date = formatDate(cleanReport.created_at);
            
            html += `
                <div class="report-item" style="animation-delay: ${index * 0.1}s">
                    <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                        <strong><i class="fas fa-user"></i> ${cleanReport.name}</strong>
                        <span style="color:#888; font-size:14px;">${date}</span>
                    </div>
                    
                    <div style="margin-bottom:10px;">
                        <strong><i class="fas fa-bolt"></i> Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:</strong>
                        <span> ${cleanReport.type}</span>
                    </div>
                    
                    <div style="margin-bottom:10px;">
                        <strong><i class="fas fa-map-marker-alt"></i> Ø§Ù„Ù…Ù†Ø·Ù‚Ø©:</strong>
                        <span> ${cleanReport.location}</span>
                    </div>
                    
                    <div style="margin-bottom:10px;">
                        <strong><i class="fas fa-info-circle"></i> Ø§Ù„ØªÙØ§ØµÙŠÙ„:</strong>
                        <span> ${cleanReport.details}</span>
                    </div>
                    
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <span style="background: ${getStatusColor(cleanReport.status)}; 
                              color: white; padding: 4px 12px; border-radius: 20px; font-size: 14px;">
                            <i class="fas fa-${getStatusIcon(cleanReport.status)}"></i> ${cleanReport.status}
                        </span>
                        <span style="color:#888; font-size:14px;">
                            <i class="fas fa-phone"></i> ${cleanReport.phone}
                        </span>
                    </div>
                    
                    ${cleanReport.reply ? `
                        <div style="margin-top:10px; padding:10px; background:rgba(31,111,235,0.1); border-radius:8px;">
                            <strong style="color:#1f6feb;"><i class="fas fa-reply"></i> Ø±Ø¯ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©:</strong>
                            <p style="margin-top:5px;">${cleanReport.reply}</p>
                        </div>
                    ` : ''}
                </div>
            `;
        });
        
        reportsDiv.innerHTML = html;
        
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹:', error);
        reportsDiv.innerHTML = `
            <div class="error-message">
                <p>âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹</p>
                <small>${error.message}</small>
                <button onclick="loadReports()" style="margin-top:10px; padding:8px 16px; background:#1f6feb; color:white; border:none; border-radius:5px; cursor:pointer;">
                    <i class="fas fa-redo"></i> Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©
                </button>
            </div>
        `;
    }
}

// Ù…Ø³Ø§Ø¹Ø¯Ø§Øª Ù„Ù„Ø­Ø§Ù„Ø©
function getStatusColor(status) {
    const colors = {
        'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©': '#f39c12',
        'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©': '#3498db',
        'ØªÙ… Ø§Ù„Ø­Ù„': '#2ecc71',
        'Ù…Ù„ØºÙŠ': '#e74c3c'
    };
    return colors[status] || '#f39c12';
}

function getStatusIcon(status) {
    const icons = {
        'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©': 'clock',
        'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©': 'tools',
        'ØªÙ… Ø§Ù„Ø­Ù„': 'check-circle',
        'Ù…Ù„ØºÙŠ': 'times-circle'
    };
    return icons[status] || 'clock';
}

// ==================== Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ù„Ø§Øº ====================

async function submitReport(event) {
    event.preventDefault();
    
    const submitBtn = document.getElementById('submitBtn');
    const originalText = submitBtn.innerHTML;
    
    try {
        // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø²Ø±
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...';
        
        // Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        const reportData = {
            type: document.getElementById('type').value.trim(),
            name: sanitizeText(document.getElementById('name').value.trim()),
            phone: sanitizeText(document.getElementById('phone').value.trim()),
            location: sanitizeText(document.getElementById('location').value.trim()),
            details: sanitizeText(document.getElementById('details').value.trim()),
            status: 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©',
            created_at: new Date().toISOString()
        };
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        if (!reportData.type || !reportData.name || !reportData.phone || !reportData.location || !reportData.details) {
            throw new Error('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
        }
        
        // ØªÙ‡ÙŠØ¦Ø© Supabase
        const supabase = initializeSupabase();
        if (!supabase) throw new Error('ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…');
        
        // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        const { data, error } = await supabase
            .from('reports')
            .insert([reportData])
            .select();
        
        if (error) throw error;
        
        // Ù†Ø¬Ø§Ø­
        showAlert('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ù„Ø§Øº Ø¨Ù†Ø¬Ø§Ø­', 'success');
        document.getElementById('reportForm').reset();
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
        setTimeout(loadReports, 1000);
        
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„:', error);
        showAlert(`âŒ ${error.message}`, 'error');
    } finally {
        // Ø¥Ø¹Ø§Ø¯Ø© ØªÙ…ÙƒÙŠÙ† Ø§Ù„Ø²Ø±
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalText;
    }
}

// ==================== Ø§Ù„ØªÙ‡ÙŠØ¦Ø© ====================

// Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
document.addEventListener('DOMContentLoaded', () => {
    console.log('ğŸš€ Ø¨Ø¯Ø¡ ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚...');
    
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª
    setTimeout(loadReports, 500);
    
    // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
    document.getElementById('reportForm').addEventListener('submit', submitReport);
    
    // ØªØ­Ø¯ÙŠØ« Ø¯ÙˆØ±ÙŠ ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©
    setInterval(() => {
        if (!document.hidden) {
            loadReports();
        }
    }, 60000);
});

// ØªØ³Ø¬ÙŠÙ„ Ù„Ù„ØªØµØ­ÙŠØ­
console.log('âœ… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ù…Ù„');
</script>

<style>
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
}

.report-item {
    animation: fadeIn 0.5s ease;
}
</style>
</body>
</html>
