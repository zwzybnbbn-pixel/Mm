<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Cairo';}
body{background:#eef3f3;padding:12px;}

.back-btn{
  display:inline-block;background:#444;color:#fff;
  padding:10px 16px;border-radius:10px;text-decoration:none;
  margin-bottom:15px;font-size:16px;
  transition: all 0.3s;
}
.back-btn:hover {
  background: #333;
  transform: translateX(-5px);
}

.card{
  width:100%;background:white;padding:20px;
  border-radius:15px;box-shadow:0 3px 12px rgba(0,0,0,0.1);
  margin-bottom:15px;
  border-top: 4px solid #d32f2f;
}

h2{
  font-size:24px;color:#00695C;text-align:center;
  margin-bottom:15px;font-weight:800;
}

.info{
  background:#f9ffff;padding:15px;border-left:5px solid #00796B;
  border-radius:12px;margin-bottom:15px;
  transition: all 0.3s;
}
.info:hover {
  transform: translateX(5px);
  box-shadow: 0 3px 10px rgba(0,0,0,0.1);
}
.label{font-size:16px;font-weight:700;color:#00695C;margin-bottom:5px;}
.value{font-size:18px;color:#333;}

.emg-img{
  width:140px;height:140px;border-radius:50%;
  object-fit:cover;display:block;margin:20px auto;
  border:4px solid #d32f2f;
  box-shadow: 0 4px 15px rgba(211, 47, 47, 0.2);
  transition: all 0.3s;
}
.emg-img:hover {
  transform: scale(1.05);
  box-shadow: 0 6px 20px rgba(211, 47, 47, 0.3);
}

/* Ø²Ø± Ø§Ù„Ø®Ø±ÙŠØ·Ø© */
.map-btn{
  display:flex;width:100%;padding:15px;margin-top:15px;
  background: linear-gradient(135deg, #d32f2f, #b71c1c);color:white;font-size:18px;
  border-radius:12px;text-align:center;text-decoration:none;
  font-weight:700;justify-content:center;align-items:center;
  gap: 10px;
  transition: all 0.3s;
  border: none;
  cursor: pointer;
}
.map-btn:hover{
  background: linear-gradient(135deg, #b71c1c, #8b0000);
  transform: translateY(-3px);
  box-shadow: 0 5px 15px rgba(183, 28, 28, 0.3);
}

/* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ */
.contact-buttons {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 15px;
  margin-top: 20px;
}

.contact-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  padding: 12px;
  border-radius: 12px;
  text-decoration: none;
  font-size: 16px;
  font-weight: 600;
  transition: all 0.3s;
}

.phone-btn {
  background: linear-gradient(135deg, #00796B, #004D40);
  color: white;
}
.phone-btn:hover {
  background: linear-gradient(135deg, #004D40, #00251a);
  transform: translateY(-3px);
}

.location-btn {
  background: linear-gradient(135deg, #ff9800, #f57c00);
  color: white;
}
.location-btn:hover {
  background: linear-gradient(135deg, #f57c00, #e65100);
  transform: translateY(-3px);
}

/* Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© */
.additional-info {
  background: #fff8e1;
  padding: 15px;
  border-radius: 12px;
  margin-top: 20px;
  border-right: 5px solid #ffb300;
}

.additional-info h3 {
  color: #e65100;
  margin-bottom: 10px;
  font-size: 18px;
}

.additional-info p {
  color: #5d4037;
  line-height: 1.6;
  margin-bottom: 8px;
}

/* ØªØµÙ…ÙŠÙ… Ù…ØªØ¬Ø§ÙˆØ¨ */
@media (max-width: 768px) {
  .contact-buttons {
    grid-template-columns: 1fr;
  }
  
  .card {
    padding: 15px;
  }
  
  h2 {
    font-size: 20px;
  }
  
  .value {
    font-size: 16px;
  }
}
</style>
</head>

<body>

<a href="emergency.html" class="back-btn">â¬… Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©</a>

<img id="emgImg" class="emg-img" alt="Ù…Ø±ÙƒØ² Ø·ÙˆØ§Ø±Ø¦">

<!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ -->
<div class="card">
  <h2 id="eName">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</h2>

  <div class="info">
    <div class="label">ğŸ“ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©:</div>
    <div class="value" id="eCity"></div>
  </div>

  <div class="info">
    <div class="label">ğŸ“ Ø§Ù„Ù‡Ø§ØªÙ:</div>
    <div class="value" id="ePhone"></div>
  </div>

  <div class="info">
    <div class="label">ğŸ“ Ø§Ù„ÙˆØµÙ:</div>
    <div class="value" id="eDescription"></div>
  </div>

  <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ -->
  <div class="contact-buttons">
    <a id="callBtn" class="contact-btn phone-btn" href="#">
      <span>ğŸ“</span> Ø§ØªØµÙ„ Ø§Ù„Ø¢Ù†
    </a>
    <a id="locationBtn" class="contact-btn location-btn" href="#" target="_blank">
      <span>ğŸ“</span> ÙØªØ­ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
    </a>
  </div>

  <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© -->
  <div id="additionalInfo" class="additional-info"></div>

  <button id="mapBtn" class="map-btn">
    <span>ğŸ—ºï¸</span> Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
  </button>
</div>

<!-- Ø§Ø³ØªÙŠØ±Ø§Ø¯ Supabase SDK -->
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>

<script type="module">
// ğŸ”§ Ø§Ø³ØªØ¨Ø¯Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ù‚ÙŠÙ… Ø¨Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ø´Ø±ÙˆØ¹Ùƒ Ø§Ù„Ø®Ø§ØµØ©
const SUPABASE_URL = "https://gxuumjhtutkipvkljjhj.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd4dXVtamh0dXRraXB2a2xqamhqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU1NTM2MzEsImV4cCI6MjA4MTEyOTYzMX0.rmsSRTQ57cAJ3VAiQMe0mdxEYcERh6zQDep7DN_frFI";

// Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù…ÙŠÙ„ Supabase
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ø±Ù Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ Ù…Ù† URL
const urlParams = new URLSearchParams(window.location.search);
const emergencyId = urlParams.get("id");

/* ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ */
async function loadEmergency(){
  if (!emergencyId) {
    document.getElementById("eName").textContent = "Ø®Ø·Ø£: Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø¹Ø±Ù Ù„Ù„Ø·ÙˆØ§Ø±Ø¦";
    return;
  }

  try {
    const { data: emergency, error } = await supabase
      .from('emergency')
      .select('*')
      .eq('id', emergencyId)
      .single();

    if (error) {
      console.error('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·ÙˆØ§Ø±Ø¦:', error);
      document.getElementById("eName").textContent = "Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª";
      return;
    }

    if (!emergency) {
      document.getElementById("eName").textContent = "Ù…Ø±ÙƒØ² Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯";
      return;
    }

    const e = emergency;

    // ØªØ­Ø¯ÙŠØ« Ø¹Ù†Ø§ØµØ± Ø§Ù„ØµÙØ­Ø©
    document.getElementById("eName").textContent = e.name || "Ù…Ø±ÙƒØ² Ø·ÙˆØ§Ø±Ø¦";
    document.getElementById("eCity").textContent = e.city || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
    document.getElementById("ePhone").textContent = e.phone || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
    document.getElementById("eDescription").textContent = e.description || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ Ù…ÙØµÙ„";
    
    // ØµÙˆØ±Ø© Ø§Ù„Ù…Ø±ÙƒØ²
    const imgSrc = e.img && e.img.trim() !== "" 
      ? e.img 
      : "https://i.postimg.cc/W1msLKWD/emergency-default.jpg";
    document.getElementById("emgImg").src = imgSrc;
    document.getElementById("emgImg").alt = e.name || "Ù…Ø±ÙƒØ² Ø·ÙˆØ§Ø±Ø¦";
    
    // ØªØ­Ø¯ÙŠØ« Ø²Ø± Ø§Ù„Ø§ØªØµØ§Ù„
    if (e.phone) {
      const phoneBtn = document.getElementById("callBtn");
      phoneBtn.href = `tel:${e.phone.replace(/\s/g, '')}`;
      phoneBtn.innerHTML = `<span>ğŸ“</span> Ø§ØªØµÙ„: ${e.phone}`;
    } else {
      document.getElementById("callBtn").style.display = "none";
    }
    
    // ØªØ­Ø¯ÙŠØ« Ø²Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹
    if (e.map) {
      const mapBtn = document.getElementById("mapBtn");
      mapBtn.onclick = () => window.open(e.map, '_blank');
      const locationBtn = document.getElementById("locationBtn");
      locationBtn.href = e.map;
    } else {
      document.getElementById("mapBtn").style.display = "none";
      document.getElementById("locationBtn").style.display = "none";
    }
    
    // Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©
    const additionalInfo = document.getElementById("additionalInfo");
    let additionalHTML = '<h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©:</h3>';
    
    if (e.address) {
      additionalHTML += `<p><strong>ğŸ  Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</strong> ${e.address}</p>`;
    }
    
    if (e.working_hours) {
      additionalHTML += `<p><strong>ğŸ•’ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„:</strong> ${e.working_hours}</p>`;
    }
    
    if (e.type) {
      additionalHTML += `<p><strong>ğŸ¥ Ø§Ù„Ù†ÙˆØ¹:</strong> ${e.type}</p>`;
    }
    
    if (e.specialties) {
      additionalHTML += `<p><strong>âš•ï¸ Ø§Ù„ØªØ®ØµØµØ§Øª:</strong> ${e.specialties}</p>`;
    }
    
    additionalInfo.innerHTML = additionalHTML;

    // ØªØ­Ø¯ÙŠØ« Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØµÙØ­Ø©
    document.title = `${e.name} - ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦`;

    // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
    console.log('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ Ø¨Ù†Ø¬Ø§Ø­:', e.name);

  } catch (err) {
    console.error('Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹:', err);
    document.getElementById("eName").textContent = "Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª";
    
    // Ø¹Ø±Ø¶ Ø²Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©
    const card = document.querySelector('.card');
    card.innerHTML += `
      <div style="text-align: center; margin-top: 20px;">
        <button onclick="loadEmergency()" style="
          padding: 10px 20px;
          background: #00796B;
          color: white;
          border: none;
          border-radius: 8px;
          font-size: 16px;
          cursor: pointer;
        ">
          ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©
        </button>
      </div>
    `;
  }
}

// Ø¥Ø¶Ø§ÙØ© ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ø§ØªØµØ§Ù„
function shareLocation() {
  if (navigator.share) {
    navigator.share({
      title: document.getElementById("eName").textContent,
      text: `Ù…Ø±ÙƒØ² Ø·ÙˆØ§Ø±Ø¦: ${document.getElementById("eName").textContent} - ${document.getElementById("ePhone").textContent}`,
      url: window.location.href
    })
    .then(() => console.log('ØªÙ…Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø¨Ù†Ø¬Ø§Ø­'))
    .catch((error) => console.log('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©:', error));
  } else {
    // Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©
    navigator.clipboard.writeText(window.location.href);
    alert('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©!');
  }
}

// Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ
function addShareButton() {
  const card = document.querySelector('.card');
  const shareBtn = document.createElement('button');
  shareBtn.className = 'map-btn';
  shareBtn.style.background = 'linear-gradient(135deg, #2196F3, #1976D2)';
  shareBtn.style.marginTop = '10px';
  shareBtn.innerHTML = '<span>ğŸ“¤</span> Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù…ÙˆÙ‚Ø¹';
  shareBtn.onclick = shareLocation;
  
  // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø²Ø± Ø¨Ø¹Ø¯ Ø²Ø± Ø§Ù„Ø®Ø±ÙŠØ·Ø©
  const mapBtn = document.getElementById('mapBtn');
  if (mapBtn) {
    mapBtn.parentNode.insertBefore(shareBtn, mapBtn.nextSibling);
  } else {
    card.appendChild(shareBtn);
  }
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
loadEmergency();

// Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
setTimeout(addShareButton, 1000);

// ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§ØªÙ
if ('connection' in navigator) {
  navigator.connection.addEventListener('change', updateConnectionStatus);
}

function updateConnectionStatus() {
  const connection = navigator.connection;
  const speed = connection ? connection.downlink + ' Mbps' : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
  console.log('Ø³Ø±Ø¹Ø© Ø§Ù„Ø§ØªØµØ§Ù„:', speed);
}

</script>

</body>
</html>