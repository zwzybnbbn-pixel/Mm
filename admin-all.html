<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… â€” Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap" rel="stylesheet">

<style>
  *{margin:0;padding:0;box-sizing:border-box;font-family:'Cairo';}
  body{background:#eef6ff;padding:12px;display:flex;justify-content:center;}
  .wrap{width:100%;max-width:780px;}

  .card{background:#fff;padding:14px;border-radius:12px;
    box-shadow:0 6px 20px rgba(0,0,0,0.07);margin-bottom:14px;}

  h1{color:#0d4d91;text-align:center;margin-bottom:12px;font-size:22px}

  label{font-weight:700;color:#0d4d91;margin-top:8px;display:block}
  input,textarea,select{
    width:100%;padding:10px;border-radius:10px;
    border:1px solid #d0d7e6;margin-top:5px
  }

  .btn{background:#0d4d91;color:#fff;padding:10px 13px;border:0;
    border-radius:10px;cursor:pointer;font-weight:700}

  .ghost{background:#fff;color:#0d4d91;border:1px solid #d0d7e6}

  .place{display:flex;justify-content:space-between;align-items:center;
    gap:10px;background:#fff;padding:10px;border-radius:10px;
    border-right:4px solid #0d4d91;margin-bottom:8px}

  .thumb{width:60px;height:60px;border-radius:10px;object-fit:cover}
  .actions{display:flex;gap:8px}
  .small{padding:6px 10px;border-radius:8px;cursor:pointer;border:0}
  .edit{background:#2e7d32;color:#fff}
  .del{background:#c62828;color:#fff}
</style>
</head>

<body>
<div class="wrap">

  <!-- Authentication -->
  <div class="card">
    <h1>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</h1>

    <div id="authBox">
      <input id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
      <input id="password" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
      <button id="loginBtn" class="btn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>

      <button id="logoutBtn" class="btn ghost" style="display:none">Ø®Ø±ÙˆØ¬</button>
      <div id="userInfo" style="display:none;margin-top:10px;font-weight:700;color:#0d4d91"></div>
    </div>
  </div>

  <!-- SELECT COLLECTION -->
  <div class="card">
    <label>Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…</label>
    <select id="collectionSelect">
      <option value="tourism_cafes">â˜• ÙƒÙˆÙÙŠ</option>
      <option value="tourism_hotels">ğŸ¨ ÙÙ†Ø§Ø¯Ù‚</option>
      <option value="tourism_places">ğŸ“ Ø£Ù…Ø§ÙƒÙ† Ø¹Ø§Ù…Ø©</option>
      <option value="tourism_restaurants">ğŸ½ Ù…Ø·Ø§Ø¹Ù…</option>
    </select>
  </div>

  <!-- FORM -->
  <div class="card">
    <div style="display:flex;align-items:center;justify-content:space-between">
      <strong style="color:#0d4d91">Ø¥Ø¶Ø§ÙØ© / ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª</strong>
      <div id="modeLabel" style="color:#666">Ø§Ù„ÙˆØ¶Ø¹: Ø¥Ø¶Ø§ÙØ©</div>
    </div>

    <label>Ø§Ù„Ø§Ø³Ù…</label>
    <input id="name">

    <label>Ø§Ù„ÙˆØµÙ</label>
    <textarea id="desc"></textarea>

    <label>Ø§Ù„Ù‡Ø§ØªÙ</label>
    <input id="phone">

    <label>Ø§Ù„ØµÙˆØ±Ø© (Ø±Ø§Ø¨Ø· URL)</label>
    <input id="image">

    <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
    <input id="address">

    <label>Ø§Ù„Ø®Ø±ÙŠØ·Ø© (Ø¥Ø·Ø§Ø± HTML)</label>
    <textarea id="map"></textarea>

    <label>Ø±Ø§Ø¨Ø· Ø§Ù„Ø®Ø±ÙŠØ·Ø©</label>
    <input id="map_link">

    <!-- Ø§Ù„Ø³Ø¹Ø± -->
    <div id="priceBox" style="display:none">
      <label>Ø§Ù„Ø³Ø¹Ø±</label>
      <input id="price" placeholder="Ù…Ø«Ø§Ù„: 15000 Ø±ÙŠØ§Ù„">
    </div>

    <!-- Ø§Ù„Ø®Ø¯Ù…Ø§Øª -->
    <div id="servicesBox" style="display:none">
      <label>Ø§Ù„Ø®Ø¯Ù…Ø§Øª</label>
      <textarea id="services"></textarea>
    </div>

    <button id="saveBtn" class="btn" style="margin-top:10px">Ø­ÙØ¸</button>
    <button id="resetBtn" class="btn ghost" style="margin-top:10px">ØªÙØ±ÙŠØº</button>

    <input type="hidden" id="editId">
  </div>

  <!-- LIST -->
  <div class="card">
    <strong style="color:#0d4d91">Ø§Ù„Ø¹Ù†Ø§ØµØ±</strong>
    <div id="list" style="margin-top:10px">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
  </div>

</div>

<script type="module">

import { db, auth } from "./firebase-config.js";

import {
  collection, getDocs, addDoc, updateDoc, deleteDoc, doc, getDoc
} from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

import {
  signInWithEmailAndPassword,
  signOut,
  onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";

/* ELEMENTS */
const emailIn  = document.getElementById("email");
const passIn   = document.getElementById("password");
const loginBtn = document.getElementById("loginBtn");
const logoutBtn = document.getElementById("logoutBtn");
const userInfo  = document.getElementById("userInfo");

const colSelect = document.getElementById("collectionSelect");

const nameIn = document.getElementById("name");
const descIn = document.getElementById("desc");
const phoneIn = document.getElementById("phone");
const imageIn = document.getElementById("image");
const addressIn = document.getElementById("address");
const mapIn = document.getElementById("map");
const mapLinkIn = document.getElementById("map_link");

const priceBox = document.getElementById("priceBox");
const priceIn = document.getElementById("price");

const servicesBox = document.getElementById("servicesBox");
const servicesIn = document.getElementById("services");

const editId = document.getElementById("editId");

const saveBtn = document.getElementById("saveBtn");
const resetBtn = document.getElementById("resetBtn");
const modeLabel = document.getElementById("modeLabel");

const listBox = document.getElementById("list");


/* LOGIN */
loginBtn.onclick = async () => {
  try {
    await signInWithEmailAndPassword(auth, emailIn.value, passIn.value);
  } catch (e) {
    alert("Ø®Ø·Ø£: " + e.message);
  }
};

logoutBtn.onclick = () => signOut(auth);

onAuthStateChanged(auth, user => {
  if (user) {
    loginBtn.style.display = "none";
    logoutBtn.style.display = "inline-block";
    userInfo.style.display = "block";
    userInfo.textContent = user.email;

    loadItems();
  } else {
    logoutBtn.style.display = "none";
    loginBtn.style.display = "inline-block";
    userInfo.style.display = "none";
    listBox.innerHTML = "<p>Ø³Ø¬Ù‘Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„</p>";
  }
});


/* LOAD */
async function loadItems() {
  const colName = colSelect.value;

  listBox.innerHTML = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...";

  const snap = await getDocs(collection(db, colName));

  if (snap.empty) {
    listBox.innerHTML = "<p style='color:#777'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ±</p>";
    return;
  }

  listBox.innerHTML = "";

  snap.forEach(s => {
    const d = s.data();

    const box = document.createElement("div");
    box.className = "place";

    box.innerHTML = `
      <div style="display:flex;gap:10px;align-items:center">
        <img src="${d.image || ''}" class="thumb">
        <div>
          <div style="font-weight:700;color:#0d4d91">${d.name}</div>
          <div style="font-size:14px;color:#444">${d.phone}</div>
        </div>
      </div>

      <div class="actions">
        <button class="small edit" data-id="${s.id}">ØªØ¹Ø¯ÙŠÙ„</button>
        <button class="small del" data-id="${s.id}">Ø­Ø°Ù</button>
      </div>
    `;

    listBox.appendChild(box);
  });

  document.querySelectorAll(".edit").forEach(btn=>{
    btn.onclick = () => loadToForm(btn.dataset.id);
  });

  document.querySelectorAll(".del").forEach(btn=>{
    btn.onclick = () => deleteItem(btn.dataset.id);
  });
}


/* LOAD TO FORM */
async function loadToForm(id) {
  const colName = colSelect.value;

  const s = await getDoc(doc(db, colName, id));
  if (!s.exists()) return alert("Ø§Ù„Ø¹Ù†ØµØ± ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯");

  const d = s.data();

  nameIn.value  = d.name || "";
  descIn.value  = d.desc || "";
  phoneIn.value = d.phone || "";
  imageIn.value = d.image || "";
  addressIn.value = d.address || "";
  mapIn.value  = d.map || "";
  mapLinkIn.value = d.map_link || "";

  if (colName === "tourism_hotels") {
    priceBox.style.display = "block";
    priceIn.value = d.price || "";

    servicesBox.style.display = "block";
    servicesIn.value = d.services || "";
  }

  editId.value = id;
  modeLabel.textContent = "Ø§Ù„ÙˆØ¶Ø¹: ØªØ¹Ø¯ÙŠÙ„";

  window.scrollTo({top:0,behavior:"smooth"});
}


/* SAVE */
saveBtn.onclick = async () => {
  if (!auth.currentUser) return alert("Ø³Ø¬Ù‘Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");

  const colName = colSelect.value;
  const id = editId.value;

  const data = {
    name: nameIn.value,
    desc: descIn.value,
    phone: phoneIn.value,
    image: imageIn.value,
    address: addressIn.value,
    map: mapIn.value,
    map_link: mapLinkIn.value,
    updated_at: Date.now()
  };

  if (colName === "tourism_hotels") {
    data.price = priceIn.value;
    data.services = servicesIn.value;
  }

  if (id) {
    await updateDoc(doc(db, colName, id), data);
    alert("ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­");
  } else {
    await addDoc(collection(db, colName), {
      ...data,
      created_at: Date.now()
    });
    alert("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©");
  }

  reset();
  loadItems();
};


/* DELETE */
async function deleteItem(id) {
  const colName = colSelect.value;
  if (!confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù†ØµØ±ØŸ")) return;
  await deleteDoc(doc(db, colName, id));
  loadItems();
}


/* RESET */
function reset() {
  nameIn.value = "";
  descIn.value = "";
  phoneIn.value = "";
  imageIn.value = "";
  addressIn.value = "";
  mapIn.value = "";
  mapLinkIn.value = "";
  priceIn.value = "";
  servicesIn.value = "";

  editId.value = "";
  modeLabel.textContent = "Ø§Ù„ÙˆØ¶Ø¹: Ø¥Ø¶Ø§ÙØ©";
}

resetBtn.onclick = reset;


/* SWITCH COLLECTION (Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø³Ø¹Ø± ÙˆØ§Ù„Ø®Ø¯Ù…Ø§Øª ÙÙ‚Ø· Ù„Ù„ÙÙ†Ø§Ø¯Ù‚) */
colSelect.onchange = () => {
  if (colSelect.value === "tourism_hotels") {
    priceBox.style.display = "block";
    servicesBox.style.display = "block";
  } else {
    priceBox.style.display = "none";
    servicesBox.style.display = "none";
  }
  loadItems();
};

</script>
</body>
</html>
