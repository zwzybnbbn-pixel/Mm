<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø³Ø¨Ø¨ Ø§Ù„Ø§Ù†Ù‚Ø·Ø§Ø¹ â€“ ÙƒÙ‡Ø±Ø¨Ø§Ø¡ Ø¹ØªÙ‚</title>

<!-- ========== ğŸ”’ Ø±Ø¤ÙˆØ³ Ø§Ù„Ø£Ù…Ø§Ù† Ø§Ù„ÙƒØ§Ù…Ù„Ø© ========== -->
<meta http-equiv="Content-Security-Policy" content="
  default-src 'self';
  script-src 'self' https://cdn.jsdelivr.net https://*.supabase.co 'unsafe-inline';
  style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
  font-src 'self' https://fonts.gstatic.com;
  connect-src 'self' https://*.supabase.co;
  img-src 'self' data: https:;
  frame-src 'none';
  object-src 'none';
  base-uri 'self';
  form-action 'self';
">

<!-- Ø±Ø¤ÙˆØ³ Ø§Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© -->
<meta http-equiv="X-Frame-Options" content="DENY">
<meta http-equiv="X-Content-Type-Options" content="nosniff">
<meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
<meta http-equiv="Permissions-Policy" content="
  camera=(), 
  microphone=(), 
  geolocation=(), 
  payment=(), 
  accelerometer=(), 
  gyroscope=(), 
  magnetometer=(), 
  midi=(), 
  usb=()
">

<!-- Cross-Origin headers for better isolation -->
<meta http-equiv="Cross-Origin-Embedder-Policy" content="require-corp">
<meta http-equiv="Cross-Origin-Opener-Policy" content="same-origin">
<meta http-equiv="Cross-Origin-Resource-Policy" content="same-origin">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Cairo',sans-serif;}
body{background:linear-gradient(to bottom,#0a0a0a,#111,#1a1a1a,#222);min-height:100vh;color:white;padding:15px;}
header{text-align:center;margin-bottom:25px;}
header h2{font-size:32px;font-weight:800;color:#1f6feb;}
#reason-box{display:flex;flex-direction:column;gap:16px;max-width:650px;margin:0 auto;}
.item{background:rgba(255,255,255,0.07);padding:18px;border-radius:16px;backdrop-filter:blur(5px);box-shadow:0 6px 18px rgba(0,0,0,0.45);border:1px solid #30363d;transition:0.25s;}
.item:hover{background:rgba(255,255,255,0.12);transform:translateY(-3px);}
.item p{font-size:18px;margin-bottom:8px;line-height:1.6;}
.item strong{color:#1f6feb;font-weight:700;}
.item small{font-size:14px;opacity:.8;display:block;margin-top:10px;color:#aaa;}
.back-btn{display:block;width:100%;max-width:250px;margin:25px auto;background:#1f6feb;color:white;text-align:center;padding:12px;font-size:18px;text-decoration:none;font-weight:700;border-radius:14px;transition:0.2s;border:none;cursor:pointer;}
.back-btn:hover{background:#2b7fff;transform:scale(1.05);}
.no-data{text-align:center;padding:30px;font-size:18px;color:#aaa;background:rgba(255,255,255,0.05);border-radius:12px;border:1px dashed #444;}
.error-message{text-align:center;padding:30px;font-size:18px;color:#ff6b6b;background:rgba(255,107,107,0.1);border-radius:12px;border:1px solid #ff6b6b;}
.loader{border:4px solid rgba(255,255,255,0.1);border-top:4px solid #1f6feb;border-radius:50%;width:40px;height:40px;animation:spin 1s linear infinite;margin:20px auto;}
@keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
.error-btn{background:#1f6feb;color:white;border:none;padding:10px 20px;border-radius:8px;cursor:pointer;margin-top:15px;font-family:inherit;}
.security-badge{position:fixed;top:10px;right:10px;background:rgba(46,204,113,0.1);color:#2ecc71;padding:5px 10px;border-radius:5px;font-size:12px;z-index:1000;border:1px solid #2ecc71;}
</style>
</head>
<body>

<!-- Ø´Ø§Ø±Ø© Ø§Ù„Ø£Ù…Ø§Ù† -->
<div class="security-badge" title="Ø§Ù„ØµÙØ­Ø© Ù…Ø­Ù…ÙŠØ© Ø¨Ø£Ø­Ø¯Ø« Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø£Ù…Ø§Ù†">ğŸ›¡ï¸ Ø¢Ù…Ù†</div>

<header>
  <h2>âš¡ Ø£Ø³Ø¨Ø§Ø¨ Ø§Ù„Ø§Ù†Ù‚Ø·Ø§Ø¹</h2>
  <p style="text-align:center; opacity:0.8; margin-top:10px;">Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø£Ø³Ø¨Ø§Ø¨ Ø§Ù†Ù‚Ø·Ø§Ø¹ Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡ Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø© Ù…Ù† Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</p>
</header>

<div id="reason-box">
  <div class="loader"></div>
  <p style="text-aligncenter; opacity:0.7;">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
</div>

<a href="index2.html" class="back-btn">â¬… Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>

<script>
// ==================== Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ù…Ø­Ø³Ù† ====================
class SecurityManager {
    constructor() {
        this.initialized = false;
        this.requestCount = 0;
        this.maxRequests = 30;
        this.init();
    }
    
    init() {
        // Ø­Ù…Ø§ÙŠØ© Ø¶Ø¯ XSS
        this.setupXSSProtection();
        // Ø­Ù…Ø§ÙŠØ© Ø¶Ø¯ CSRF
        this.setupCSRFProtection();
        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø£Ù…Ù†ÙŠØ©
        this.setupLogging();
    }
    
    setupXSSProtection() {
        // Ù…Ù†Ø¹ innerHTML ØºÙŠØ± Ø§Ù„Ø¢Ù…Ù†
        this.originalInnerHTML = Element.prototype.innerHTML;
        Element.prototype.innerHTML = function(value) {
            if (typeof value === 'string' && /<script|<iframe|<object|<embed/i.test(value)) {
                console.warn('âš ï¸ Ù…Ø­Ø§ÙˆÙ„Ø© Ø­Ù‚Ù† XSS ØªÙ… Ù…Ù†Ø¹Ù‡Ø§');
                return this.originalInnerHTML;
            }
            return this.originalInnerHTML.apply(this, arguments);
        };
    }
    
    setupCSRFProtection() {
        // ØªÙˆÙ„ÙŠØ¯ ØªÙˆÙƒÙ† CSRF
        this.csrfToken = this.generateToken();
        document.cookie = `csrf_token=${this.csrfToken}; Secure; SameSite=Strict`;
    }
    
    setupLogging() {
        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø£Ù…Ù†ÙŠØ©
        window.addEventListener('securitypolicyviolation', (e) => {
            console.warn(`ğŸš¨ Ø§Ù†ØªÙ‡Ø§Ùƒ Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø£Ù…Ø§Ù†: ${e.violatedDirective}`);
        });
    }
    
    generateToken() {
        return Array.from(crypto.getRandomValues(new Uint8Array(32)))
            .map(b => b.toString(16).padStart(2, '0')).join('');
    }
    
    sanitizeHTML(text) {
        if (!text) return '';
        const div = document.createElement('div');
        div.textContent = String(text);
        return div.innerHTML
            .replace(/javascript:/gi, '')
            .replace(/data:/gi, '')
            .replace(/vbscript:/gi, '')
            .replace(/on\w+\s*=/gi, '');
    }
    
    validateInput(input) {
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø·ÙˆÙ„ Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª
        if (input.length > 5000) return false;
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø®Ø·Ø±Ø©
        const dangerousPatterns = [
            /<script/i,
            /javascript:/i,
            /data:/i,
            /vbscript:/i,
            /on\w+\s*=/i,
            /eval\(/i
        ];
        
        return !dangerousPatterns.some(pattern => pattern.test(input));
    }
}

// ==================== Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ====================
const security = new SecurityManager();
const box = document.getElementById('reason-box');

// Ø¥Ø¹Ø¯Ø§Ø¯ Supabase
const SUPABASE_CONFIG = {
    url: 'https://gxuumjhtutkipvkljjhj.supabase.co',
    key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd4dXVtamh0dXRraXB2a2xqamhqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU1NTM2MzEsImV4cCI6MjA4MTEyOTYzMX0.rmsSRTQ57cAJ3VAiQMe0mdxEYcERh6zQDep7DN_frFI'
};

let supabaseClient = null;

// ğŸ”§ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
async function initializeApp() {
    try {
        console.log('ğŸ›¡ï¸ Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ù…Ø¹ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø£Ù…Ø§Ù† Ù…ØªÙ‚Ø¯Ù…Ø©...');
        
        // Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ Supabase
        await waitForSupabase();
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¹Ù…ÙŠÙ„
        const { createClient } = window.supabase;
        supabaseClient = createClient(SUPABASE_CONFIG.url, SUPABASE_CONFIG.key);
        
        console.log('âœ… ØªÙ… ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­');
        return true;
        
    } catch (error) {
        console.error('âŒ ÙØ´Ù„ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©:', error);
        return false;
    }
}

// ğŸ”§ Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ Supabase
function waitForSupabase() {
    return new Promise((resolve, reject) => {
        let attempts = 0;
        const maxAttempts = 10;
        
        const checkSupabase = () => {
            attempts++;
            
            if (window.supabase && window.supabase.createClient) {
                resolve();
            } else if (attempts >= maxAttempts) {
                reject(new Error('Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© ØªØ­Ù…ÙŠÙ„ Supabase'));
            } else {
                setTimeout(checkSupabase, 500);
            }
        };
        
        checkSupabase();
    });
}

// ğŸ”§ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
async function loadReasons() {
    try {
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„
        if (!navigator.onLine) {
            throw new Error('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª');
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Supabase
        if (!supabaseClient) {
            const initialized = await initializeApp();
            if (!initialized) throw new Error('ÙØ´Ù„ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…');
        }
        
        // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        const { data: reasons, error } = await supabaseClient
            .from('reasons')
            .select('*')
            .order('updated_at', { ascending: false })
            .limit(100);
        
        if (error) throw error;
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        if (!reasons || !Array.isArray(reasons)) {
            throw new Error('Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ§Ù„Ø­Ø©');
        }
        
        // Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        displayReasons(reasons);
        
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
        showError(error);
    }
}

// ğŸ”§ Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ø¢Ù…Ù†)
function displayReasons(reasons) {
    // Ù…Ø³Ø­ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù‚Ø¯ÙŠÙ…
    box.innerHTML = '';
    
    if (!reasons || reasons.length === 0) {
        const noDataDiv = document.createElement('div');
        noDataDiv.className = 'no-data';
        
        const message = document.createElement('p');
        message.textContent = 'ğŸ“­ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¨Ø§Ø¨ Ù…Ø³Ø¬Ù„Ø© Ø­Ø§Ù„ÙŠØ§Ù‹';
        noDataDiv.appendChild(message);
        
        const subMessage = document.createElement('small');
        subMessage.textContent = 'Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø£Ø³Ø¨Ø§Ø¨ Ø§Ù„Ø§Ù†Ù‚Ø·Ø§Ø¹ Ù‚Ø±ÙŠØ¨Ø§Ù‹ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©';
        noDataDiv.appendChild(subMessage);
        
        box.appendChild(noDataDiv);
        return;
    }
    
    // Ø¹Ø±Ø¶ ÙƒÙ„ Ø³Ø¨Ø¨
    reasons.forEach((reason, index) => {
        // ÙØ§ØµÙ„ Ù„Ù„Ø£Ø³Ø¨Ø§Ø¨ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
        if (index === 1) {
            const separator = document.createElement('div');
            separator.textContent = 'â€”â€”â€” Ø£Ø³Ø¨Ø§Ø¨ Ø³Ø§Ø¨Ù‚Ø© â€”â€”â€”';
            separator.style.cssText = 'text-align:center; margin:20px 0; color:#666; font-size:14px;';
            box.appendChild(separator);
        }
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¹Ù†ØµØ±
        const item = document.createElement('div');
        item.className = 'item';
        
        // Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
        const reasonText = document.createElement('p');
        const strongReason = document.createElement('strong');
        strongReason.textContent = 'Ø§Ù„Ø³Ø¨Ø¨: ';
        reasonText.appendChild(strongReason);
        reasonText.appendChild(document.createTextNode(security.sanitizeHTML(reason.text || "â€”")));
        item.appendChild(reasonText);
        
        // Ø§Ù„ØªÙØ§ØµÙŠÙ„
        if (reason.details && security.validateInput(reason.details)) {
            const details = document.createElement('p');
            details.style.marginTop = '8px';
            const strongDetails = document.createElement('strong');
            strongDetails.textContent = 'Ø§Ù„ØªÙØ§ØµÙŠÙ„: ';
            details.appendChild(strongDetails);
            details.appendChild(document.createTextNode(security.sanitizeHTML(reason.details)));
            item.appendChild(details);
        }
        
        // Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©
        if (reason.affected_areas && security.validateInput(reason.affected_areas)) {
            const areas = document.createElement('p');
            areas.style.marginTop = '8px';
            const strongAreas = document.createElement('strong');
            strongAreas.textContent = 'Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©: ';
            areas.appendChild(strongAreas);
            areas.appendChild(document.createTextNode(security.sanitizeHTML(reason.affected_areas)));
            item.appendChild(areas);
        }
        
        // Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹
        if (reason.estimated_time && security.validateInput(reason.estimated_time)) {
            const time = document.createElement('p');
            time.style.marginTop = '8px';
            time.style.color = '#4ecdc4';
            const strongTime = document.createElement('strong');
            strongTime.textContent = 'Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ Ù„Ù„Ø¥ØµÙ„Ø§Ø­: ';
            time.appendChild(strongTime);
            time.appendChild(document.createTextNode(security.sanitizeHTML(reason.estimated_time)));
            item.appendChild(time);
        }
        
        // ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ­Ø¯ÙŠØ«
        const updateDate = document.createElement('small');
        const strongUpdate = document.createElement('strong');
        strongUpdate.textContent = 'Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ';
        updateDate.appendChild(strongUpdate);
        
        try {
            const date = new Date(reason.updated_at);
            if (!isNaN(date.getTime())) {
                updateDate.appendChild(document.createTextNode(
                    date.toLocaleString('ar-EG', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    })
                ));
            } else {
                updateDate.appendChild(document.createTextNode('â€”'));
            }
        } catch {
            updateDate.appendChild(document.createTextNode('â€”'));
        }
        item.appendChild(updateDate);
        
        // Ø§Ù„Ø­Ø§Ù„Ø©
        if (reason.status && security.validateInput(reason.status)) {
            const status = document.createElement('small');
            status.style.display = 'block';
            
            // Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø­Ø§Ù„Ø©
            const statusColors = {
                'ØªÙ… Ø§Ù„Ø­Ù„': '#2ecc71',
                'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©': '#3498db',
                'Ù…Ø¹Ù„Ù‚': '#e74c3c',
                'ØªØ­Øª Ø§Ù„Ø¯Ø±Ø§Ø³Ø©': '#9b59b6'
            };
            
            status.style.color = statusColors[reason.status] || '#f39c12';
            
            const strongStatus = document.createElement('strong');
            strongStatus.textContent = 'Ø§Ù„Ø­Ø§Ù„Ø©: ';
            status.appendChild(strongStatus);
            status.appendChild(document.createTextNode(security.sanitizeHTML(reason.status)));
            item.appendChild(status);
        }
        
        box.appendChild(item);
    });
    
    // Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª
    const counter = document.createElement('div');
    counter.style.cssText = 'text-align:center; margin-top:20px; color:#666; font-size:14px;';
    counter.textContent = `Ø¹Ø±Ø¶ ${reasons.length} Ø³Ø¨Ø¨`;
    box.appendChild(counter);
}

// ğŸ”§ Ø¹Ø±Ø¶ Ø§Ù„Ø®Ø·Ø£
function showError(error) {
    const errorDiv = document.createElement('div');
    errorDiv.className = 'error-message';
    
    const title = document.createElement('p');
    title.textContent = 'âš ï¸ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª';
    errorDiv.appendChild(title);
    
    const message = document.createElement('small');
    message.textContent = security.sanitizeHTML(error.message) || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
    errorDiv.appendChild(message);
    
    const retryBtn = document.createElement('button');
    retryBtn.className = 'error-btn';
    retryBtn.textContent = 'ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©';
    retryBtn.onclick = () => {
        box.innerHTML = '<div class="loader"></div><p style="text-align:center; opacity:0.7;">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>';
        setTimeout(loadReasons, 1000);
    };
    errorDiv.appendChild(retryBtn);
    
    box.innerHTML = '';
    box.appendChild(errorDiv);
}

// ==================== Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„ ====================
document.addEventListener('DOMContentLoaded', async () => {
    console.log('ğŸš€ Ø¨Ø¯Ø¡ ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¢Ù…Ù†...');
    
    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    const success = await initializeApp();
    
    if (success) {
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        setTimeout(loadReasons, 500);
        
        // ØªØ­Ø¯ÙŠØ« Ø¯ÙˆØ±ÙŠ
        setInterval(() => {
            if (!document.hidden && navigator.onLine) {
                loadReasons();
            }
        }, 60000);
    } else {
        showError(new Error('ÙØ´Ù„ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…'));
    }
});

// ØªØ­Ø¯ÙŠØ« Ø¹Ù†Ø¯ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø©
document.addEventListener('visibilitychange', () => {
    if (!document.hidden && supabaseClient) {
        console.log('ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
        loadReasons();
    }
});

// Ù…Ù†Ø¹ Ø§Ù„Ù†Ø³Ø® ØºÙŠØ± Ø§Ù„Ù…ØµØ±Ø­ Ø¨Ù‡
document.addEventListener('copy', (e) => {
    if (!e.target.classList.contains('item')) {
        e.preventDefault();
        alert('Ø§Ù„Ù†Ø³Ø® ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­ Ø¨Ù‡ Ù…Ù† Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©');
    }
});
</script>
</body>
  </html>
