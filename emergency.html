<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·ÙˆØ§Ø±Ø¦</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap" rel="stylesheet">

<style>
  * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Cairo', sans-serif; }
  
  body {
    background: #f1f1f1;
    padding: 15px;
    max-width: 1200px;
    margin: 0 auto;
  }
  
  .header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    flex-wrap: wrap;
    gap: 15px;
  }
  
  .back-btn {
    background: #444;
    color: white;
    padding: 10px 16px;
    border-radius: 10px;
    text-decoration: none;
    font-size: 16px;
    display: inline-flex;
    align-items: center;
    gap: 8px;
  }
  
  h1 {
    text-align: center;
    color: #00695C;
    margin-bottom: 20px;
    font-size: 28px;
    font-weight: 800;
    flex: 1;
  }
  
  .loading {
    text-align: center;
    font-size: 20px;
    color: #00796B;
    margin-bottom: 20px;
    font-weight: 700;
    padding: 20px;
  }
  
  .error-message {
    text-align: center;
    font-size: 18px;
    color: #d32f2f;
    margin: 20px;
    padding: 20px;
    background: #ffebee;
    border-radius: 10px;
    border-right: 5px solid #d32f2f;
  }
  
  .search-box {
    width: 100%;
    padding: 12px 16px;
    border-radius: 10px;
    border: 2px solid #00796B;
    font-size: 16px;
    margin-bottom: 20px;
    background: white;
  }
  
  .search-box:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(0, 121, 107, 0.2);
  }
  
  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
  }
  
  @media (max-width: 768px) {
    .grid {
      grid-template-columns: 1fr;
    }
    .header {
      flex-direction: column;
      text-align: center;
    }
  }
  
  .card {
    background: white;
    border-radius: 14px;
    box-shadow: 0 3px 12px rgba(0, 0, 0, 0.1);
    padding: 20px;
    transition: transform 0.3s, box-shadow 0.3s;
    border-top: 4px solid #d32f2f;
    display: flex;
    flex-direction: column;
    height: 100%;
  }
  
  .card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
  }
  
  .card-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 15px;
  }
  
  .emergency-icon {
    width: 50px;
    height: 50px;
    background: #ffebee;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    color: #d32f2f;
  }
  
  .card h3 {
    font-size: 22px;
    color: #004D40;
    font-weight: 700;
    margin-bottom: 8px;
    flex: 1;
  }
  
  .card p {
    font-size: 16px;
    color: #555;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  .card p strong {
    color: #00695C;
    min-width: 70px;
  }
  
  .map-img {
    width: 100%;
    height: 180px;
    border-radius: 10px;
    object-fit: cover;
    margin: 15px 0;
    border: 2px solid #e0e0e0;
  }
  
  .btn {
    display: block;
    margin-top: auto;
    text-decoration: none;
    padding: 12px;
    text-align: center;
    background: linear-gradient(135deg, #d32f2f, #b71c1c);
    color: white;
    border-radius: 10px;
    font-size: 16px;
    font-weight: 600;
    transition: background 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }
  
  .btn:hover {
    background: linear-gradient(135deg, #b71c1c, #8b0000);
  }
  
  .empty-state {
    text-align: center;
    padding: 40px 20px;
    color: #666;
    font-size: 18px;
    grid-column: 1 / -1;
  }
  
  .empty-state img {
    width: 100px;
    height: 100px;
    margin-bottom: 20px;
    opacity: 0.5;
  }
</style>
</head>

<body>

<div class="header">
  <a href="index.html" class="back-btn">â¬… Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
  <h1>ğŸš¨ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·ÙˆØ§Ø±Ø¦</h1>
</div>

<input type="text" id="searchInput" class="search-box" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙƒØ²ØŒ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©ØŒ Ø£Ùˆ Ø§Ù„Ù‡Ø§ØªÙ...">

<!-- Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
<div id="loading" class="loading">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·ÙˆØ§Ø±Ø¦...</div>

<div id="emergencyBox" class="grid"></div>

<!-- Ø§Ø³ØªÙŠØ±Ø§Ø¯ Supabase SDK -->
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>

<script type="module">
// ğŸ”§ Ø§Ø³ØªØ¨Ø¯Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ù‚ÙŠÙ… Ø¨Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ø´Ø±ÙˆØ¹Ùƒ Ø§Ù„Ø®Ø§ØµØ©
const SUPABASE_URL = "https://gxuumjhtutkipvkljjhj.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd4dXVtamh0dXRraXB2a2xqamhqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU1NTM2MzEsImV4cCI6MjA4MTEyOTYzMX0.rmsSRTQ57cAJ3VAiQMe0mdxEYcERh6zQDep7DN_frFI";

// Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù…ÙŠÙ„ Supabase
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

const box = document.getElementById("emergencyBox");
const loading = document.getElementById("loading");
const searchInput = document.getElementById("searchInput");

let allEmergencies = [];

// ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·ÙˆØ§Ø±Ø¦
async function loadEmergency() {
  try {
    loading.style.display = "block";
    box.innerHTML = "";

    // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø¬Ø¯ÙˆÙ„ emergency
    const { data: emergencies, error } = await supabase
      .from('emergency')
      .select('*')
      .order('name', { ascending: true });

    if (error) {
      console.error('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·ÙˆØ§Ø±Ø¦:', error);
      showError(`Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${error.message}`);
      return;
    }

    allEmergencies = emergencies || [];
    
    if (allEmergencies.length === 0) {
      showEmptyState();
      return;
    }

    renderEmergencies(allEmergencies);
    
  } catch (err) {
    console.error('Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹:', err);
    showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
  } finally {
    loading.style.display = "none";
  }
}

// Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£
function showError(message) {
  box.innerHTML = `
    <div class="error-message">
      <div style="font-size: 40px; margin-bottom: 10px;">âš ï¸</div>
      ${message}
      <div style="margin-top: 15px;">
        <button onclick="loadEmergency()" style="
          padding: 10px 20px;
          background: #00796B;
          color: white;
          border: none;
          border-radius: 8px;
          cursor: pointer;
          font-size: 16px;
        ">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</button>
      </div>
    </div>
  `;
}

// Ø¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø¨ÙŠØ§Ù†Ø§Øª
function showEmptyState() {
  box.innerHTML = `
    <div class="empty-state">
      <div style="font-size: 60px; color: #ccc; margin-bottom: 20px;">ğŸš‘</div>
      <h3 style="color: #666; margin-bottom: 10px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø±Ø§ÙƒØ² Ø·ÙˆØ§Ø±Ø¦ Ù…Ø³Ø¬Ù„Ø©</h3>
      <p>Ù„Ù… ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø£ÙŠ Ù…Ø±Ø§ÙƒØ² Ø·ÙˆØ§Ø±Ø¦ Ø¨Ø¹Ø¯.</p>
    </div>
  `;
}

// Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·ÙˆØ§Ø±Ø¦
function renderEmergencies(emergencies) {
  if (emergencies.length === 0) {
    showEmptyState();
    return;
  }

  box.innerHTML = emergencies.map(emergency => {
    const imgSrc = emergency.img && emergency.img.trim() !== "" 
      ? emergency.img 
      : "https://i.postimg.cc/W1msLKWD/emergency-default.jpg";

    // ØªØ­Ø¯ÙŠØ¯ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
    let icon = "ğŸ¥";
    if (emergency.type) {
      const type = emergency.type.toLowerCase();
      if (type.includes('Ù…Ø³ØªØ´ÙÙ‰')) icon = "ğŸ¥";
      else if (type.includes('Ù…Ø±ÙƒØ²') || type.includes('Ø¹ÙŠØ§Ø¯Ø©')) icon = "ğŸš‘";
      else if (type.includes('ØµÙŠØ¯Ù„ÙŠØ©')) icon = "ğŸ’Š";
      else if (type.includes('Ø¥Ø³Ø¹Ø§Ù')) icon = "ğŸš¨";
    }

    return `
      <div class="card">
        <div class="card-header">
          <div class="emergency-icon">${icon}</div>
          <h3>${emergency.name || "Ù…Ø±ÙƒØ² Ø·ÙˆØ§Ø±Ø¦"}</h3>
        </div>
        
        ${emergency.img ? `<img class="map-img" src="${imgSrc}" alt="${emergency.name || 'Ù…Ø±ÙƒØ² Ø·ÙˆØ§Ø±Ø¦'}" onerror="this.src='https://i.postimg.cc/W1msLKWD/emergency-default.jpg'">` : ''}
        
        <p><strong>ğŸ“ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©:</strong> ${emergency.city || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</p>
        <p><strong>ğŸ“ Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${emergency.phone || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</p>
        ${emergency.address ? `<p><strong>ğŸ  Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</strong> ${emergency.address}</p>` : ''}
        ${emergency.working_hours ? `<p><strong>ğŸ•’ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„:</strong> ${emergency.working_hours}</p>` : ''}
        ${emergency.description ? `<p><strong>ğŸ“ Ø§Ù„ÙˆØµÙ:</strong> ${emergency.description.substring(0, 100)}${emergency.description.length > 100 ? '...' : ''}</p>` : ''}
        
        <a class="btn" href="emergency-details.html?id=${emergency.id}">
          <span>ğŸ‘</span> Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙƒØ§Ù…Ù„Ø©
        </a>
      </div>
    `;
  }).join('');
}

// ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø¨Ø­Ø«
searchInput.addEventListener('input', (e) => {
  const searchTerm = e.target.value.trim().toLowerCase();
  
  if (searchTerm === '') {
    renderEmergencies(allEmergencies);
    return;
  }

  const filtered = allEmergencies.filter(emergency => {
    return (
      (emergency.name && emergency.name.toLowerCase().includes(searchTerm)) ||
      (emergency.city && emergency.city.toLowerCase().includes(searchTerm)) ||
      (emergency.phone && emergency.phone.includes(searchTerm)) ||
      (emergency.address && emergency.address.toLowerCase().includes(searchTerm)) ||
      (emergency.description && emergency.description.toLowerCase().includes(searchTerm))
    );
  });

  renderEmergencies(filtered);
});

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
loadEmergency();

// Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙØ§Ø±ØºØ§Ù‹
async function addSampleDataIfEmpty() {
  try {
    const { data, error } = await supabase
      .from('emergency')
      .select('id')
      .limit(1);

    if (!error && data.length === 0) {
      console.log('Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù„Ù„Ø·ÙˆØ§Ø±Ø¦...');
      
      const sampleData = [
        {
          name: "Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ù…Ù„Ùƒ ÙÙ‡Ø¯ Ù„Ù„Ø·ÙˆØ§Ø±Ø¦",
          city: "Ø§Ù„Ø±ÙŠØ§Ø¶",
          phone: "0112345678",
          address: "Ø­ÙŠ Ø§Ù„Ø¹Ù„ÙŠØ§ØŒ Ø´Ø§Ø±Ø¹ Ø§Ù„Ù…Ù„Ùƒ ÙÙ‡Ø¯",
          working_hours: "24 Ø³Ø§Ø¹Ø©",
          description: "Ù…Ø³ØªØ´ÙÙ‰ Ù…ØªÙƒØ§Ù…Ù„ Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ ÙˆØ§Ù„Ø¹Ù†Ø§ÙŠØ© Ø§Ù„Ù…Ø±ÙƒØ²Ø©",
          img: "https://i.postimg.cc/W1msLKWD/emergency-default.jpg"
        },
        {
          name: "Ù…Ø±ÙƒØ² Ø§Ù„Ø¥Ø³Ø¹Ø§Ù Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ",
          city: "Ø¬Ø¯Ø©",
          phone: "0123456789",
          address: "Ø­ÙŠ Ø§Ù„Ø³Ù„Ø§Ù…Ø©ØŒ Ø·Ø±ÙŠÙ‚ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©",
          working_hours: "24 Ø³Ø§Ø¹Ø©",
          description: "Ù…Ø±ÙƒØ² Ø¥Ø³Ø¹Ø§Ù Ù…Ø¬Ù‡Ø² Ø¨ÙƒØ§Ù…Ù„ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ©",
          img: "https://i.postimg.cc/W1msLKWD/emergency-default.jpg"
        }
      ];

      const { error: insertError } = await supabase
        .from('emergency')
        .insert(sampleData);

      if (!insertError) {
        console.log('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­');
        loadEmergency(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
      }
    }
  } catch (err) {
    console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©:', err);
  }
}

// ØªÙØ¹ÙŠÙ„ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
// addSampleDataIfEmpty();

</script>

</body>
</html>