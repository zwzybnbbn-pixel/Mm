<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… â€” Dashboard</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
  :root{
    --bg1:#004D40; --bg2:#00695C; --accent:#009688; --white:#fff;
    --card-bg: #fff; --muted:#7a7a7a;
    --danger:#E53935; --primary:#00796B; --warning:#ff9800;
    --navbar-height: 70px;
  }
  .mobile-menu-btn {
    display: block; /* Ø¨Ø¯Ù„ none */
    background: none;
    border: none;
    color: #E53935; /* Ø§Ù„Ø£Ø­Ù…Ø± */
    font-size: 24px;
    cursor: pointer;
    padding: 10px;
  }
  *{box-sizing:border-box;margin:0;padding:0;font-family:'Cairo',sans-serif}
  html,body{height:100%; overflow-x: hidden;}
  
  body{
    background: #f5f5f5;
    color: #333;
    -webkit-font-smoothing:antialiased;
    display: flex;
    flex-direction: column;
    padding-top: var(--navbar-height);
  }

  /* Top Navigation Bar */
  .navbar {
    width: 100%;
    background: linear-gradient(90deg, var(--bg1), var(--bg2));
    color: var(--white);
    height: var(--navbar-height);
    position: fixed;
    top: 0;
    right: 0;
    z-index: 1000;
    box-shadow: 0 3px 15px rgba(0,0,0,0.1);
    display: flex;
    align-items: center;
    padding: 0 20px;
  }
  
  .navbar-content {
    width: 100%;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  .logo {
    display: flex;
    align-items: center;
    gap: 12px;
  }
  
  .logo h1 {
    font-size: 22px;
    font-weight: 800;
    white-space: nowrap;
  }
  
  .logo .subtitle {
    font-size: 12px;
    opacity: 0.8;
    margin-right: 5px;
  }
  
  .nav-menu {
    display: flex;
    gap: 5px;
    align-items: center;
    height: 100%;
    overflow-x: auto;
    padding: 0 10px;
  }
  
  .nav-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 12px 15px;
    color: rgba(255,255,255,0.8);
    text-decoration: none;
    border-radius: 8px;
    transition: all 0.3s;
    border: none;
    background: none;
    cursor: pointer;
    white-space: nowrap;
    height: 45px;
  }
  
  .nav-item:hover {
    background: rgba(255,255,255,0.1);
    color: white;
  }
  
  .nav-item.active {
    background: var(--accent);
    color: white;
    font-weight: 600;
  }
  
  .nav-item i {
    font-size: 18px;
    width: 20px;
    text-align: center;
  }
  
  .user-info {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-left: 15px;
  }
  
  .user-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: var(--accent);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    font-size: 16px;
  }
  
  .user-details {
    display: flex;
    flex-direction: column;
  }
  
  .user-name {
    font-weight: bold;
    font-size: 14px;
  }
  
  .user-role {
    font-size: 12px;
    opacity: 0.8;
  }
  
  .logout-btn {
    background: rgba(255,255,255,0.1);
    color: white;
    padding: 8px 15px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: bold;
    font-size: 14px;
    transition: all 0.3s;
    margin-right: 10px;
  }
  
  .logout-btn:hover {
    background: rgba(211, 47, 47, 0.8);
    transform: translateY(-2px);
  }
  
  .mobile-menu-btn {
    display: none;
    background: none;
    border: none;
    color: white;
    font-size: 24px;
    cursor: pointer;
    padding: 10px;
  }
  
  /* Main Content */
  .main-content {
    flex: 1;
    padding: 20px;
    min-height: calc(100vh - var(--navbar-height));
  }
  
  .page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-bottom: 20px;
    border-bottom: 1px solid #eee;
    margin-bottom: 25px;
  }
  
  .page-title {
    font-size: 24px;
    color: var(--primary);
    font-weight: 800;
  }
  
  .card {
    background: var(--card-bg);
    color: #222;
    border-radius: 16px;
    padding: 20px;
    margin: 15px 0;
    box-shadow: 0 4px 15px rgba(0,0,0,0.08);
    border: 1px solid #eee;
  }
  
  /* Stats Cards */
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
  }
  
  .stat-card {
    background: white;
    border-radius: 12px;
    padding: 20px;
    text-align: center;
    box-shadow: 0 3px 10px rgba(0,0,0,0.05);
    border-top: 4px solid;
    transition: transform 0.3s;
  }
  
  .stat-card:hover {
    transform: translateY(-5px);
  }
  
  .stat-card.doctors { border-color: #2196F3; }
  .stat-card.hospitals { border-color: #4CAF50; }
  .stat-card.clinics { border-color: #FF9800; }
  .stat-card.labs { border-color: #9C27B0; }
  .stat-card.emergency { border-color: #F44336; }
  .stat-card.blog { border-color: #607D8B; }
  
  .stat-icon {
    font-size: 30px;
    margin-bottom: 10px;
  }
  
  .stat-number {
    font-size: 32px;
    font-weight: 800;
    margin: 10px 0;
  }
  
  .stat-label {
    color: var(--muted);
    font-size: 14px;
  }
  
  /* Controls */
  .controls{
    display:flex;
    gap:10px;
    margin-bottom:20px;
    align-items:center;
    flex-wrap: wrap;
  }
  
  .controls .search{
    flex:1;
    min-width: 250px;
    padding:12px 15px;
    border-radius:10px;
    border:2px solid #eee;
    font-size:15px;
    transition: all 0.3s;
  }
  
  .controls .search:focus {
    border-color: var(--accent);
    outline: none;
    box-shadow: 0 0 0 3px rgba(0, 150, 136, 0.1);
  }
  
  .controls .btn {
    background:var(--primary);
    color:var(--card-bg);
    border:none;
    padding:12px 20px;
    border-radius:10px;
    cursor:pointer;
    font-weight:700;
    font-size:15px;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s;
  }
  
  .controls .btn:hover {
    background: var(--bg1);
    transform: translateY(-2px);
  }
  
  .controls .btn.ghost{
    background:transparent;
    color:var(--primary);
    border:2px solid var(--primary);
  }
  
  .controls .btn.ghost:hover {
    background: var(--primary);
    color: white;
  }
  
  /* Tables */
  .table-wrap{
    overflow:auto;
    border-radius: 10px;
    border: 1px solid #eee;
  }
  
  table.table{
    width:100%;
    border-collapse:collapse;
    font-size:14px;
    min-width:800px;
  }
  
  table th, table td{
    padding:15px;
    text-align:right;
    vertical-align:middle;
    border-bottom:1px solid #eee;
    color:#333;
  }
  
  table th{
    background:#f8f9fa;
    color:#555;
    font-weight:700;
    font-size:14px;
    position: sticky;
    top: 0;
  }
  
  table tr:hover {
    background: #f9f9f9;
  }
  
  .actions-row{
    display:flex;
    gap:8px;
    justify-content:flex-start;
    flex-wrap: wrap;
  }
  
  .action-btn{
    border:none;
    padding:8px 12px;
    border-radius:8px;
    cursor:pointer;
    font-weight:600;
    font-size:13px;
    display: inline-flex;
    align-items: center;
    gap: 5px;
    transition: all 0.2s;
  }
  
  .action-btn.edit{
    background:#E3F2FD;
    color:#1565C0;
  }
  
  .action-btn.edit:hover {
    background: #bbdefb;
  }
  
  .action-btn.delete{
    background:#FFEBEE;
    color:#C62828;
  }
  
  .action-btn.delete:hover {
    background: #ffcdd2;
  }
  
  .action-btn.view{
    background:#E8F5E9;
    color:#2E7D32;
  }
  
  .action-btn.view:hover {
    background: #c8e6c9;
  }
  
  .td-doctor{
    display:flex;
    align-items:center;
    gap:12px;
    justify-content:flex-end;
  }
  
  .td-doctor img{
    width:50px;
    height:50px;
    border-radius:50%;
    object-fit:cover;
    border:3px solid #eee;
  }
  
  .muted{
    color:var(--muted);
    font-size:13px;
  }
  
  /* Modal */
  .overlay{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.5);
    display:none;
    align-items:center;
    justify-content:center;
    z-index:2000;
    padding:20px;
  }
  
  .overlay.show{
    display:flex;
    animation: fadeIn 0.3s;
  }
  
  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
  
  .modal{
    width:100%;
    max-width:800px;
    background:var(--card-bg);
    color:#222;
    border-radius:16px;
    padding:25px;
    box-shadow:0 20px 50px rgba(0,0,0,0.2);
    max-height:90vh;
    overflow:auto;
    animation: slideUp 0.3s;
  }
  
  @keyframes slideUp {
    from { transform: translateY(30px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }
  
  .modal h3{
    font-size:22px;
    margin-bottom:20px;
    color:var(--primary);
    padding-bottom: 10px;
    border-bottom: 2px solid #eee;
  }
  
  .form-row{
    display:flex;
    gap:15px;
    margin-bottom:15px;
    flex-wrap:wrap;
  }
  
  .form-row .field{
    flex:1;
    min-width:200px;
  }
  
  input[type=text],
  input[type=url],
  input[type=tel],
  input[type=number],
  textarea,
  select{
    width:100%;
    padding:12px;
    border:2px solid #e6e6e6;
    border-radius:10px;
    font-size:15px;
    transition: all 0.3s;
  }
  
  input:focus,
  textarea:focus,
  select:focus {
    border-color: var(--accent);
    outline: none;
    box-shadow: 0 0 0 3px rgba(0, 150, 136, 0.1);
  }
  
  textarea{
    min-height:120px;
    resize:vertical;
  }
  
  label{
    display:block;
    margin-bottom:8px;
    font-weight:600;
    color:#555;
  }
  
  .days-grid{
    display:grid;
    grid-template-columns:repeat(auto-fill, minmax(200px, 1fr));
    gap:12px;
    margin-bottom:15px;
  }
  
  .day-field{
    background:#f8f9fa;
    padding:15px;
    border-radius:10px;
    border: 1px solid #eee;
  }
  
  .day-field input{
    background:transparent;
    border:1px solid #ddd;
    padding:8px;
    width:100%;
    border-radius: 6px;
  }
  
  .modal-actions{
    display:flex;
    gap:12px;
    justify-content:flex-end;
    margin-top:25px;
    padding-top: 20px;
    border-top: 1px solid #eee;
  }
  
  .modal .btn{
    padding:12px 25px;
    border-radius:10px;
    border:none;
    cursor:pointer;
    font-weight:700;
    font-size:15px;
    min-width: 100px;
  }
  
  .btn.save{
    background:var(--primary);
    color:#fff;
  }
  
  .btn.save:hover {
    background: var(--bg1);
  }
  
  .btn.cancel{
    background:#f5f5f5;
    color:#666;
    border: 1px solid #ddd;
  }
  
  .btn.cancel:hover {
    background: #e9e9e9;
  }
  
  /* Responsive */
  @media(max-width: 1200px){
    .nav-menu {
      padding: 0 5px;
    }
    
    .nav-item {
      padding: 10px 12px;
      font-size: 14px;
    }
    
    .nav-item i {
      font-size: 16px;
    }
  }
  
  @media(max-width: 992px){
    .nav-item span {
      display: none;
    }
    
    .nav-item {
      padding: 12px;
      justify-content: center;
    }
    
    .logo h1 {
      font-size: 18px;
    }
    
    .user-details {
      display: none;
    }
    
    .stats-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }
  
  @media(max-width: 768px){
    .mobile-menu-btn {
      display: block;
    }
    
    .nav-menu {
      position: fixed;
      top: var(--navbar-height);
      right: 0;
      width: 100%;
      background: var(--bg2);
      flex-direction: column;
      align-items: stretch;
      padding: 10px;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      z-index: 999;
    }
    
    .nav-menu.mobile-open {
      max-height: 400px;
    }
    
    .nav-item {
      padding: 15px;
      justify-content: flex-start;
    }
    
    .nav-item span {
      display: block;
    }
    
    .controls {
      flex-direction: column;
    }
    
    .controls .search {
      min-width: 100%;
    }
    
    .stats-grid {
      grid-template-columns: 1fr;
    }
    
    .modal {
      padding: 15px;
    }
    
    .form-row .field {
      min-width: 100%;
    }
  }
  
  @media(max-width: 480px){
    .navbar {
      padding: 0 10px;
    }
    
    .logo h1 {
      font-size: 16px;
    }
    
    .logout-btn span {
      display: none;
    }
    
    .logout-btn {
      padding: 10px;
    }
    
    .page-title {
      font-size: 20px;
    }
    
    .actions-row {
      flex-direction: column;
    }
    
    .action-btn {
      width: 100%;
      justify-content: center;
    }
  }
  
  /* Loading Animation */
  .loading {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 3px solid rgba(0, 150, 136, 0.3);
    border-radius: 50%;
    border-top-color: var(--primary);
    animation: spin 1s ease-in-out infinite;
  }
  
  @keyframes spin {
    to { transform: rotate(360deg); }
  }
  
  /* Success/Error Messages */
  .alert {
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  
  .alert.success {
    background: #E8F5E9;
    color: #2E7D32;
    border: 1px solid #C8E6C9;
  }
  
  .alert.error {
    background: #FFEBEE;
    color: #C62828;
    border: 1px solid #FFCDD2;
  }
  
  .alert i {
    font-size: 20px;
  }
  
  /* Empty State */
  .empty-state {
    text-align: center;
    padding: 40px 20px;
    color: #777;
  }
  
  .empty-state i {
    font-size: 50px;
    margin-bottom: 20px;
    opacity: 0.5;
  }
</style>
</head>

<body>

<!-- Top Navigation Bar -->
<div class="navbar">
  <div class="navbar-content">
    <div class="logo">
      <div class="user-avatar">ğŸ‘¨â€ğŸ’¼</div>
      <div>
        <h1>ğŸ‘¨â€âš•ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>
        <div class="subtitle">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø·Ø¨ÙŠ</div>
      </div>
    </div>
    
    <button class="mobile-menu-btn" id="mobileMenuBtn">
      <i class="fas fa-bars"></i>
    </button>
    
    <nav class="nav-menu" id="navMenu">
      <button class="nav-item active" data-page="dashboard">
        <i class="fas fa-tachometer-alt"></i>
        <span>Ø§Ù„Ù…Ù„Ø®Øµ</span>
      </button>
      
      <button class="nav-item" data-page="doctors">
        <i class="fas fa-user-md"></i>
        <span>Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡</span>
      </button>
      
      <button class="nav-item" data-page="hospitals">
        <i class="fas fa-hospital"></i>
        <span>Ø§Ù„Ù…Ø³ØªØ´ÙÙŠØ§Øª</span>
      </button>
      
      <button class="nav-item" data-page="clinics">
        <i class="fas fa-clinic-medical"></i>
        <span>Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª</span>
      </button>
      
      <button class="nav-item" data-page="labs">
        <i class="fas fa-flask"></i>
        <span>Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª</span>
      </button>
      
      <button class="nav-item" data-page="emergency">
        <i class="fas fa-ambulance"></i>
        <span>Ø§Ù„Ø·ÙˆØ§Ø±Ø¦</span>
      </button>
      
      <button class="nav-item" data-page="blog">
        <i class="fas fa-newspaper"></i>
        <span>Ø§Ù„Ù…Ø¯ÙˆÙ†Ø©</span>
      </button>
    </nav>
    
    <div class="user-info">
      <div class="user-details">
        <div class="user-name" id="userName">Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…</div>
        <div class="user-role" id="userRole">Ù…Ø³Ø¤ÙˆÙ„</div>
      </div>
      <button onclick="logoutDashboard()" class="logout-btn">
        <i class="fas fa-sign-out-alt"></i>
        <span>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</span>
      </button>
    </div>
  </div>
</div>

<!-- Main Content -->
<div class="main-content">
  <!-- Page Header -->
  <div class="page-header">
    <div class="page-title" id="pageTitle">Ø§Ù„Ù…Ù„Ø®Øµ</div>
  </div>
  
  <!-- Dashboard Stats -->
  <div id="pageDashboard" class="page-content" style="display: block;">
    <div class="stats-grid">
      <div class="stat-card doctors">
        <div class="stat-icon">ğŸ‘¨â€âš•ï¸</div>
        <div class="stat-number" id="statDoctors">0</div>
        <div class="stat-label">Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡</div>
      </div>
      
      <div class="stat-card hospitals">
        <div class="stat-icon">ğŸ¥</div>
        <div class="stat-number" id="statHospitals">0</div>
        <div class="stat-label">Ø§Ù„Ù…Ø³ØªØ´ÙÙŠØ§Øª</div>
      </div>
      
      <div class="stat-card clinics">
        <div class="stat-icon">ğŸ©º</div>
        <div class="stat-number" id="statClinics">0</div>
        <div class="stat-label">Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª</div>
      </div>
      
      <div class="stat-card labs">
        <div class="stat-icon">ğŸ§ª</div>
        <div class="stat-number" id="statLabs">0</div>
        <div class="stat-label">Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª</div>
      </div>
      
      <div class="stat-card emergency">
        <div class="stat-icon">ğŸš¨</div>
        <div class="stat-number" id="statEmergency">0</div>
        <div class="stat-label">Ø§Ù„Ø·ÙˆØ§Ø±Ø¦</div>
      </div>
      
      <div class="stat-card blog">
        <div class="stat-icon">ğŸ“°</div>
        <div class="stat-number" id="statBlog">0</div>
        <div class="stat-label">Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª</div>
      </div>
    </div>
    
    <div class="card">
      <h3 style="color: var(--primary); margin-bottom: 15px;">ğŸ‘‹ Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹</h3>
      <p style="color: #666; line-height: 1.6;">
        ÙŠÙ…ÙƒÙ†Ùƒ Ù…Ù† Ø®Ù„Ø§Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø¬Ù…ÙŠØ¹ Ù…Ø­ØªÙˆÙŠØ§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø·Ø¨ÙŠ. Ø§Ø³ØªØ®Ø¯Ù… Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø¹Ù„ÙˆÙŠ Ù„Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ø®ØªÙ„ÙØ©.
      </p>
      <div style="margin-top: 20px; display: flex; gap: 15px; flex-wrap: wrap;">
        <div style="background: #E3F2FD; padding: 15px; border-radius: 10px; flex: 1; min-width: 200px;">
          <div style="font-weight: bold; color: #1565C0; margin-bottom: 5px;">ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø©</div>
          <div class="muted">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…</div>
        </div>
        <div style="background: #E8F5E9; padding: 15px; border-radius: 10px; flex: 1; min-width: 200px;">
          <div style="font-weight: bold; color: #2E7D32; margin-bottom: 5px;">âš¡ Ø¥Ø¯Ø§Ø±Ø© Ø³Ø±ÙŠØ¹Ø©</div>
          <div class="muted">Ø¥Ø¶Ø§ÙØ© ÙˆØªØ¹Ø¯ÙŠÙ„ ÙˆØ­Ø°Ù Ø¨Ø³Ù‡ÙˆÙ„Ø©</div>
        </div>
        <div style="background: #FFF3E0; padding: 15px; border-radius: 10px; flex: 1; min-width: 200px;">
          <div style="font-weight: bold; color: #F57C00; margin-bottom: 5px;">ğŸ” Ø¨Ø­Ø« Ù…ØªÙ‚Ø¯Ù…</div>
          <div class="muted">Ø§Ø¨Ø­Ø« ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø³Ø±Ø¹Ø©</div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Doctors Page -->
  <div id="pageDoctors" class="page-content" style="display: none;">
    <div class="controls">
      <input id="searchDoctors" class="search" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ø·Ø¨ÙŠØ¨ØŒ Ø§Ù„ØªØ®ØµØµØŒ Ø£Ùˆ Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰..." />
      <button id="btnAddDoctor" class="btn">
        <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø·Ø¨ÙŠØ¨
      </button>
    </div>
    <div class="table-wrap">
      <table class="table" aria-label="Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡">
        <thead>
          <tr>
            <th>Ø§Ù„Ø§Ø³Ù…</th>
            <th>Ø§Ù„ØªØ®ØµØµ</th>
            <th>Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰</th>
            <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
            <th>Ø§Ù„Ø£ÙŠØ§Ù…</th>
            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
          </tr>
        </thead>
        <tbody id="doctorsTbody">
          <tr><td colspan="6" class="muted" style="text-align: center; padding: 30px;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr>
        </tbody>
      </table>
    </div>
  </div>
  
  <!-- Hospitals Page -->
  <div id="pageHospitals" class="page-content" style="display: none;">
    <div class="controls">
      <input id="searchHospitals" class="search" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰ Ø£Ùˆ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©..." />
      <button id="btnAddHospital" class="btn">
        <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ´ÙÙ‰
      </button>
    </div>
    <div class="table-wrap">
      <table class="table" aria-label="Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ´ÙÙŠØ§Øª">
        <thead>
          <tr>
            <th>Ø§Ù„Ø§Ø³Ù…</th>
            <th>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</th>
            <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
            <th>Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</th>
            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
          </tr>
        </thead>
        <tbody id="hospitalsTbody">
          <tr><td colspan="5" class="muted" style="text-align: center; padding: 30px;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr>
        </tbody>
      </table>
    </div>
  </div>
  
  <!-- Clinics Page -->
  <div id="pageClinics" class="page-content" style="display: none;">
    <div class="controls">
      <input id="searchClinics" class="search" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© Ø£Ùˆ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©..." />
      <button id="btnAddClinic" class="btn">
        <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø¹ÙŠØ§Ø¯Ø©
      </button>
    </div>
    <div class="table-wrap">
      <table class="table" aria-label="Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª">
        <thead>
          <tr>
            <th>Ø§Ù„Ø§Ø³Ù…</th>
            <th>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</th>
            <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
            <th>Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</th>
            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
          </tr>
        </thead>
        <tbody id="clinicsTbody">
          <tr><td colspan="5" class="muted" style="text-align: center; padding: 30px;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr>
        </tbody>
      </table>
    </div>
  </div>
  
  <!-- Labs Page -->
  <div id="pageLabs" class="page-content" style="display: none;">
    <div class="controls">
      <input id="searchLabs" class="search" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ù…Ø®ØªØ¨Ø± Ø£Ùˆ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©..." />
      <button id="btnAddLab" class="btn">
        <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ø®ØªØ¨Ø±
      </button>
    </div>
    <div class="table-wrap">
      <table class="table" aria-label="Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª">
        <thead>
          <tr>
            <th>Ø§Ù„Ø§Ø³Ù…</th>
            <th>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</th>
            <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
            <th>Ø§Ù„ÙØ­ÙˆØµØ§Øª</th>
            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
          </tr>
        </thead>
        <tbody id="labsTbody">
          <tr><td colspan="5" class="muted" style="text-align: center; padding: 30px;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr>
        </tbody>
      </table>
    </div>
  </div>
  
  <!-- Emergency Page -->
  <div id="pageEmergency" class="page-content" style="display: none;">
    <div class="controls">
      <input id="searchEmergency" class="search" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙƒØ² Ø£Ùˆ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©..." />
      <button id="btnAddEmergency" class="btn">
        <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ø±ÙƒØ² Ø·ÙˆØ§Ø±Ø¦
      </button>
    </div>
    <div class="table-wrap">
      <table class="table" aria-label="Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·ÙˆØ§Ø±Ø¦">
        <thead>
          <tr>
            <th>Ø§Ù„Ø§Ø³Ù…</th>
            <th>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</th>
            <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
            <th>Ø§Ù„ÙˆØµÙ</th>
            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
          </tr>
        </thead>
        <tbody id="emergencyTbody">
          <tr><td colspan="5" class="muted" style="text-align: center; padding: 30px;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr>
        </tbody>
      </table>
    </div>
  </div>
  
  <!-- Blog Page -->
  <div id="pageBlog" class="page-content" style="display: none;">
    <div class="controls">
      <input id="searchBlog" class="search" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¨Ø¹Ù†ÙˆØ§Ù† Ø£Ùˆ Ù…Ù‚ØªØ·Ù..." />
      <button id="btnAddBlog" class="btn">
        <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ù‚Ø§Ù„
      </button>
    </div>
    <div class="table-wrap">
      <table class="table" aria-label="Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª">
        <thead>
          <tr>
            <th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
            <th>Ø§Ù„Ù…Ù‚ØªØ·Ù</th>
            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
          </tr>
        </thead>
        <tbody id="blogTbody">
          <tr><td colspan="4" class="muted" style="text-align: center; padding: 30px;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Modal for Add/Edit -->
<div id="overlay" class="overlay" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <h3 id="modalTitle">Ø¥Ø¶Ø§ÙØ© / ØªØ¹Ø¯ÙŠÙ„</h3>
    <form id="modalForm">
      <div id="formFields"></div>
      <div class="modal-actions">
        <button type="button" id="btnCancel" class="btn cancel">
          <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡
        </button>
        <button type="submit" id="btnSave" class="btn save">
          <i class="fas fa-save"></i> Ø­ÙØ¸
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Supabase SDK -->
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>

<script type="module">
// Supabase Configuration
const SUPABASE_URL = "https://gxuumjhtutkipvkljjhj.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd4dXVtamh0dXRraXB2a2xqamhqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU1NTM2MzEsImV4cCI6MjA4MTEyOTYzMX0.rmsSRTQ57cAJ3VAiQMe0mdxEYcERh6zQDep7DN_frFI";

// Create Supabase client
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// DOM Elements
const pageContents = document.querySelectorAll('.page-content');
const navItems = document.querySelectorAll('.nav-item');
const pageTitle = document.getElementById('pageTitle');
const mobileMenuBtn = document.getElementById('mobileMenuBtn');
const navMenu = document.getElementById('navMenu');

// Statistics Elements
const statElements = {
  doctors: document.getElementById('statDoctors'),
  hospitals: document.getElementById('statHospitals'),
  clinics: document.getElementById('statClinics'),
  labs: document.getElementById('statLabs'),
  emergency: document.getElementById('statEmergency'),
  blog: document.getElementById('statBlog')
};

// Table Bodies
const tbodies = {
  doctors: document.getElementById('doctorsTbody'),
  hospitals: document.getElementById('hospitalsTbody'),
  clinics: document.getElementById('clinicsTbody'),
  labs: document.getElementById('labsTbody'),
  emergency: document.getElementById('emergencyTbody'),
  blog: document.getElementById('blogTbody')
};

// Controls
const controls = {
  btnAddDoctor: document.getElementById('btnAddDoctor'),
  btnAddHospital: document.getElementById('btnAddHospital'),
  btnAddClinic: document.getElementById('btnAddClinic'),
  btnAddLab: document.getElementById('btnAddLab'),
  btnAddEmergency: document.getElementById('btnAddEmergency'),
  btnAddBlog: document.getElementById('btnAddBlog'),
  searchDoctors: document.getElementById('searchDoctors'),
  searchHospitals: document.getElementById('searchHospitals'),
  searchClinics: document.getElementById('searchClinics'),
  searchLabs: document.getElementById('searchLabs'),
  searchEmergency: document.getElementById('searchEmergency'),
  searchBlog: document.getElementById('searchBlog')
};

// Modal Elements
const overlay = document.getElementById('overlay');
const formFields = document.getElementById('formFields');
const modalTitle = document.getElementById('modalTitle');
const modalForm = document.getElementById('modalForm');
const btnCancel = document.getElementById('btnCancel');
const btnSave = document.getElementById('btnSave');

// State
let currentPage = 'dashboard';
let editing = null;
let allData = {
  doctors: [],
  hospitals: [],
  clinics: [],
  labs: [],
  emergency: [],
  blog: []
};

// Mobile Menu Toggle
mobileMenuBtn.addEventListener('click', () => {
  navMenu.classList.toggle('mobile-open');
});

// Close mobile menu when clicking outside
document.addEventListener('click', (e) => {
  if (!navMenu.contains(e.target) && !mobileMenuBtn.contains(e.target)) {
    navMenu.classList.remove('mobile-open');
  }
});

// Check Authentication
async function checkAuth() {
  try {
    const { data: { session }, error } = await supabase.auth.getSession();
    
    if (error || !session) {
      window.location.href = 'login.html';
      return null;
    }
    
    return session;
  } catch (error) {
    console.error('Authentication error:', error);
    window.location.href = 'login.html';
    return null;
  }
}

// Utility Functions
function escapeHtml(text) {
  const map = {
    '&': '&amp;',
    '<': '&lt;',
    '>': '&gt;',
    '"': '&quot;',
    "'": '&#039;'
  };
  return String(text || '').replace(/[&<>"']/g, m => map[m]);
}

function showAlert(message, type = 'success') {
  const alertDiv = document.createElement('div');
  alertDiv.className = `alert ${type}`;
  alertDiv.innerHTML = `
    <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
    <span>${message}</span>
  `;
  
  const mainContent = document.querySelector('.main-content');
  const firstPage = mainContent.querySelector('.page-content');
  mainContent.insertBefore(alertDiv, firstPage);
  
  setTimeout(() => {
    if (alertDiv.parentNode) {
      alertDiv.remove();
    }
  }, 5000);
}

// Navigation
function navigateTo(page) {
  // Hide all pages
  pageContents.forEach(p => p.style.display = 'none');
  
  // Remove active class from all nav items
  navItems.forEach(item => item.classList.remove('active'));
  
  // Show selected page
  const pageId = 'page' + page.charAt(0).toUpperCase() + page.slice(1);
  const targetPage = document.getElementById(pageId);
  if (targetPage) {
    targetPage.style.display = 'block';
  }
  
  // Add active class to selected nav item
  const targetNav = document.querySelector(`[data-page="${page}"]`);
  if (targetNav) {
    targetNav.classList.add('active');
  }
  
  // Update page title
  const titles = {
    dashboard: 'Ø§Ù„Ù…Ù„Ø®Øµ',
    doctors: 'Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡',
    hospitals: 'Ø§Ù„Ù…Ø³ØªØ´ÙÙŠØ§Øª',
    clinics: 'Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª',
    labs: 'Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª',
    emergency: 'Ø§Ù„Ø·ÙˆØ§Ø±Ø¦',
    blog: 'Ø§Ù„Ù…Ø¯ÙˆÙ†Ø©'
  };
  pageTitle.textContent = titles[page] || page;
  currentPage = page;
  
  // Close mobile menu on navigation
  navMenu.classList.remove('mobile-open');
  
  // Load data if needed
  if (page !== 'dashboard') {
    loadTableData(page);
  }
}

// Event Listeners for Navigation
navItems.forEach(item => {
  item.addEventListener('click', (e) => {
    e.preventDefault();
    const page = item.dataset.page;
    if (page) {
      navigateTo(page);
    }
  });
});

// Load Statistics
async function loadStatistics() {
  try {
    // Load counts for all tables
    const collections = ['doctors', 'hospitals', 'clinics', 'labs', 'emergency', 'blog'];
    
    for (const collection of collections) {
      try {
        const { count, error } = await supabase
          .from(collection)
          .select('*', { count: 'exact', head: true });
        
        if (!error && statElements[collection]) {
          statElements[collection].textContent = count || 0;
        }
      } catch (collectionError) {
        console.error(`Error loading ${collection} statistics:`, collectionError);
        if (statElements[collection]) {
          statElements[collection].textContent = '0';
        }
      }
    }
  } catch (error) {
    console.error('Error loading statistics:', error);
  }
}

// Load Table Data
async function loadTableData(tableName) {
  const tbody = tbodies[tableName];
  if (!tbody) return;
  
  tbody.innerHTML = `<tr><td colspan="6" class="muted" style="text-align: center; padding: 30px;">
    <div class="loading"></div> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...
  </td></tr>`;
  
  try {
    const { data, error } = await supabase
      .from(tableName)
      .select('*')
      .order('created_at', { ascending: false });
    
    if (error) {
      console.error(`Error loading ${tableName}:`, error);
      throw error;
    }
    
    allData[tableName] = data || [];
    
    if (!data || data.length === 0) {
      tbody.innerHTML = `
        <tr>
          <td colspan="6" class="empty-state">
            <i class="fas fa-inbox"></i>
            <h3 style="color: #777; margin: 15px 0;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</h3>
            <p>Ù„Ù… ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø£ÙŠ ${getTableArabicName(tableName)} Ø¨Ø¹Ø¯.</p>
            <button class="btn" onclick="addNewItem('${tableName}')" style="margin-top: 15px;">
              <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© ${getTableArabicName(tableName)}
            </button>
          </td>
        </tr>
      `;
      return;
    }
    
    renderTableData(tableName, data);
    
  } catch (error) {
    console.error(`Error loading ${tableName}:`, error);
    tbody.innerHTML = `
      <tr>
        <td colspan="6" class="muted" style="text-align: center; padding: 30px; color: #d32f2f;">
          <i class="fas fa-exclamation-circle"></i> Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
          <div style="margin-top: 10px;">
            <button class="btn" onclick="loadTableData('${tableName}')" style="background: #d32f2f; padding: 8px 15px; font-size: 14px;">
              Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©
            </button>
          </div>
        </td>
      </tr>
    `;
  }
}

function getTableArabicName(tableName) {
  const names = {
    doctors: 'Ø£Ø·Ø¨Ø§Ø¡',
    hospitals: 'Ù…Ø³ØªØ´ÙÙŠØ§Øª',
    clinics: 'Ø¹ÙŠØ§Ø¯Ø§Øª',
    labs: 'Ù…Ø®ØªØ¨Ø±Ø§Øª',
    emergency: 'Ù…Ø±Ø§ÙƒØ² Ø·ÙˆØ§Ø±Ø¦',
    blog: 'Ù…Ù‚Ø§Ù„Ø§Øª'
  };
  return names[tableName] || 'Ø¨ÙŠØ§Ù†Ø§Øª';
}

function renderTableData(tableName, data) {
  const tbody = tbodies[tableName];
  if (!tbody) return;
  
  let html = '';
  
  switch (tableName) {
    case 'doctors':
      data.forEach(item => {
        html += `
          <tr>
            <td>
              <div class="td-doctor">
                <img src="${escapeHtml(item.img || 'https://via.placeholder.com/100')}" alt="${escapeHtml(item.name)}" onerror="this.src='https://via.placeholder.com/100'">
                <div style="text-align:right">
                  <div style="font-weight:800">${escapeHtml(item.name || '')}</div>
                  <div class="muted">${escapeHtml(item.specialty || '')}</div>
                </div>
              </div>
            </td>
            <td>${escapeHtml(item.specialty || '-')}</td>
            <td>${escapeHtml(item.hospital || '-')}</td>
            <td>${escapeHtml(item.phone || '-')}</td>
            <td>${getScheduleDays(item)}</td>
            <td>
              <div class="actions-row">
                <button class="action-btn view" onclick="viewItem('doctors', '${item.id}')">
                  <i class="fas fa-eye"></i> Ø¹Ø±Ø¶
                </button>
                <button class="action-btn edit" onclick="editItem('doctors', '${item.id}')">
                  <i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„
                </button>
                <button class="action-btn delete" onclick="deleteItem('doctors', '${item.id}')">
                  <i class="fas fa-trash"></i> Ø­Ø°Ù
                </button>
              </div>
            </td>
          </tr>
        `;
      });
      break;
      
    case 'hospitals':
    case 'clinics':
    case 'labs':
    case 'emergency':
      data.forEach(item => {
        const description = item.description ? 
          (item.description.length > 100 ? item.description.substring(0, 100) + '...' : item.description) : 
          '-';
        
        html += `
          <tr>
            <td style="font-weight:800">${escapeHtml(item.name || '')}</td>
            <td>${escapeHtml(item.city || '-')}</td>
            <td>${escapeHtml(item.phone || '-')}</td>
            <td class="muted" style="max-width:200px">${escapeHtml(description)}</td>
            <td>
              <div class="actions-row">
                <button class="action-btn view" onclick="viewItem('${tableName}', '${item.id}')">
                  <i class="fas fa-eye"></i> Ø¹Ø±Ø¶
                </button>
                <button class="action-btn edit" onclick="editItem('${tableName}', '${item.id}')">
                  <i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„
                </button>
                <button class="action-btn delete" onclick="deleteItem('${tableName}', '${item.id}')">
                  <i class="fas fa-trash"></i> Ø­Ø°Ù
                </button>
              </div>
            </td>
          </tr>
        `;
      });
      break;
      
    case 'blog':
      data.forEach(item => {
        const excerpt = item.excerpt ? 
          (item.excerpt.length > 80 ? item.excerpt.substring(0, 80) + '...' : item.excerpt) : 
          '-';
        
        const date = item.created_at ? 
          new Date(item.created_at).toLocaleDateString('ar-SA') : 
          '-';
        
        html += `
          <tr>
            <td style="font-weight:800">${escapeHtml(item.title || '')}</td>
            <td class="muted">${escapeHtml(excerpt)}</td>
            <td>${date}</td>
            <td>
              <div class="actions-row">
                <button class="action-btn view" onclick="viewItem('blog', '${item.id}')">
                  <i class="fas fa-eye"></i> Ø¹Ø±Ø¶
                </button>
                <button class="action-btn edit" onclick="editItem('blog', '${item.id}')">
                  <i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„
                </button>
                <button class="action-btn delete" onclick="deleteItem('blog', '${item.id}')">
                  <i class="fas fa-trash"></i> Ø­Ø°Ù
                </button>
              </div>
            </td>
          </tr>
        `;
      });
      break;
  }
  
  tbody.innerHTML = html;
}

function getScheduleDays(doctor) {
  if (!doctor || !doctor.schedule) return '-';
  const days = ['saturday', 'sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday'];
  const arabicDays = ['Ø§Ù„Ø³Ø¨Øª', 'Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©'];
  let activeDays = [];
  
  days.forEach((day, index) => {
    if (doctor.schedule[day] && doctor.schedule[day].time && doctor.schedule[day].time.trim()) {
      activeDays.push(arabicDays[index]);
    }
  });
  
  return activeDays.length > 0 ? activeDays.join('ØŒ ') : '-';
}

// Search Functionality
function setupSearch() {
  Object.keys(controls).forEach(key => {
    if (key.startsWith('search')) {
      const control = controls[key];
      const tableName = key.replace('search', '').toLowerCase();
      
      if (control) {
        control.addEventListener('input', () => {
          const searchTerm = control.value.trim().toLowerCase();
          const data = allData[tableName];
          
          if (!data) return;
          
          if (searchTerm === '') {
            renderTableData(tableName, data);
            return;
          }
          
          const filtered = data.filter(item => {
            switch (tableName) {
              case 'doctors':
                return (
                  (item.name && item.name.toLowerCase().includes(searchTerm)) ||
                  (item.specialty && item.specialty.toLowerCase().includes(searchTerm)) ||
                  (item.hospital && item.hospital.toLowerCase().includes(searchTerm)) ||
                  (item.phone && item.phone.includes(searchTerm))
                );
                
              case 'hospitals':
              case 'clinics':
              case 'labs':
              case 'emergency':
                return (
                  (item.name && item.name.toLowerCase().includes(searchTerm)) ||
                  (item.city && item.city.toLowerCase().includes(searchTerm)) ||
                  (item.phone && item.phone.includes(searchTerm)) ||
                  (item.description && item.description.toLowerCase().includes(searchTerm))
                );
                
              case 'blog':
                return (
                  (item.title && item.title.toLowerCase().includes(searchTerm)) ||
                  (item.excerpt && item.excerpt.toLowerCase().includes(searchTerm)) ||
                  (item.content && item.content.toLowerCase().includes(searchTerm))
                );
                
              default:
                return JSON.stringify(item).toLowerCase().includes(searchTerm);
            }
          });
          
          renderTableData(tableName, filtered);
        });
      }
    }
  });
}

// Add Button Handlers
if (controls.btnAddDoctor) controls.btnAddDoctor.addEventListener('click', () => addNewItem('doctors'));
if (controls.btnAddHospital) controls.btnAddHospital.addEventListener('click', () => addNewItem('hospitals'));
if (controls.btnAddClinic) controls.btnAddClinic.addEventListener('click', () => addNewItem('clinics'));
if (controls.btnAddLab) controls.btnAddLab.addEventListener('click', () => addNewItem('labs'));
if (controls.btnAddEmergency) controls.btnAddEmergency.addEventListener('click', () => addNewItem('emergency'));
if (controls.btnAddBlog) controls.btnAddBlog.addEventListener('click', () => addNewItem('blog'));

// Item Management Functions
function addNewItem(tableName) {
  editing = { collection: tableName, id: null };
  openModal(tableName, null, false);
}

async function viewItem(tableName, id) {
  editing = { collection: tableName, id, viewOnly: true };
  openModal(tableName, id, true);
}

async function editItem(tableName, id) {
  editing = { collection: tableName, id, viewOnly: false };
  openModal(tableName, id, false);
}

async function deleteItem(tableName, id) {
  if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù†ØµØ±ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©.')) {
    return;
  }
  
  try {
    const { error } = await supabase
      .from(tableName)
      .delete()
      .eq('id', id);
    
    if (error) throw error;
    
    showAlert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¹Ù†ØµØ± Ø¨Ù†Ø¬Ø§Ø­', 'success');
    loadTableData(tableName);
    loadStatistics();
    
  } catch (error) {
    console.error('Error deleting item:', error);
    showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù', 'error');
  }
}

// Modal Functions
async function openModal(tableName, id = null, viewOnly = false) {
  // Set modal title
  const action = id ? (viewOnly ? 'Ø¹Ø±Ø¶' : 'ØªØ¹Ø¯ÙŠÙ„') : 'Ø¥Ø¶Ø§ÙØ©';
  const tableNames = {
    doctors: 'Ø·Ø¨ÙŠØ¨',
    hospitals: 'Ù…Ø³ØªØ´ÙÙ‰',
    clinics: 'Ø¹ÙŠØ§Ø¯Ø©',
    labs: 'Ù…Ø®ØªØ¨Ø±',
    emergency: 'Ù…Ø±ÙƒØ² Ø·ÙˆØ§Ø±Ø¦',
    blog: 'Ù…Ù‚Ø§Ù„'
  };
  
  modalTitle.textContent = `${action} ${tableNames[tableName] || tableName}`;
  
  // Show loading
  formFields.innerHTML = `
    <div style="text-align: center; padding: 40px;">
      <div class="loading"></div>
      <div class="muted" style="margin-top: 15px;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
    </div>
  `;
  
  overlay.classList.add('show');
  
  try {
    let data = {};
    
    // If editing/viewing, fetch data
    if (id) {
      const { data: itemData, error } = await supabase
        .from(tableName)
        .select('*')
        .eq('id', id)
        .single();
      
      if (error) throw error;
      data = itemData || {};
    }
    
    // Generate form HTML based on table type
    formFields.innerHTML = generateFormHtml(tableName, data, viewOnly);
    
    // Disable form if view only
    if (viewOnly) {
      const inputs = formFields.querySelectorAll('input, textarea, select');
      inputs.forEach(input => {
        input.disabled = true;
      });
      btnSave.style.display = 'none';
    } else {
      btnSave.style.display = '';
    }
    
  } catch (error) {
    console.error('Error loading form data:', error);
    formFields.innerHTML = `
      <div style="text-align: center; padding: 40px; color: #d32f2f;">
        <i class="fas fa-exclamation-circle" style="font-size: 40px;"></i>
        <div style="margin-top: 15px; font-weight: bold;">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>
        <button class="btn" onclick="openModal('${tableName}', '${id}', ${viewOnly})" style="margin-top: 20px; background: #d32f2f;">
          <i class="fas fa-redo"></i> Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©
        </button>
      </div>
    `;
  }
}

function generateFormHtml(tableName, data = {}, viewOnly = false) {
  switch (tableName) {
    case 'doctors':
      return `
        <div class="form-row">
          <div class="field">
            <label for="name">Ø§Ø³Ù… Ø§Ù„Ø·Ø¨ÙŠØ¨ *</label>
            <input type="text" id="name" name="name" value="${escapeHtml(data.name || '')}" required>
          </div>
          <div class="field">
            <label for="specialty">Ø§Ù„ØªØ®ØµØµ</label>
            <input type="text" id="specialty" name="specialty" value="${escapeHtml(data.specialty || '')}">
          </div>
        </div>
        
        <div class="form-row">
          <div class="field">
            <label for="hospital">Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰/Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©</label>
            <input type="text" id="hospital" name="hospital" value="${escapeHtml(data.hospital || '')}">
          </div>
          <div class="field">
            <label for="phone">Ø§Ù„Ù‡Ø§ØªÙ</label>
            <input type="tel" id="phone" name="phone" value="${escapeHtml(data.phone || '')}">
          </div>
        </div>
        
        <div class="form-row">
          <div class="field">
            <label for="img">Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©</label>
            <input type="url" id="img" name="img" value="${escapeHtml(data.img || '')}" placeholder="https://example.com/image.jpg">
          </div>
        </div>
        
        <label>Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¯ÙˆØ§Ù…</label>
        <div class="days-grid">
          ${generateDayFields(data.schedule || {})}
        </div>
        
        <div class="field">
          <label for="notes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</label>
          <textarea id="notes" name="notes">${escapeHtml(data.notes || '')}</textarea>
        </div>
      `;
      
    case 'hospitals':
    case 'clinics':
    case 'labs':
    case 'emergency':
      return `
        <div class="form-row">
          <div class="field">
            <label for="name">Ø§Ù„Ø§Ø³Ù… *</label>
            <input type="text" id="name" name="name" value="${escapeHtml(data.name || '')}" required>
          </div>
          <div class="field">
            <label for="city">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label>
            <input type="text" id="city" name="city" value="${escapeHtml(data.city || '')}">
          </div>
        </div>
        
        <div class="form-row">
          <div class="field">
            <label for="phone">Ø§Ù„Ù‡Ø§ØªÙ</label>
            <input type="tel" id="phone" name="phone" value="${escapeHtml(data.phone || '')}">
          </div>
          ${tableName === 'labs' ? `
            <div class="field">
              <label for="tests">Ø§Ù„ÙØ­ÙˆØµØ§Øª (Ø§ÙØµÙ„ Ø¨ÙØ§ØµÙ„Ø©)</label>
              <input type="text" id="tests" name="tests" value="${escapeHtml(data.tests || '')}">
            </div>
          ` : `
            <div class="field">
              <label for="department">Ø§Ù„Ø£Ù‚Ø³Ø§Ù… (Ø§ÙØµÙ„ Ø¨ÙØ§ØµÙ„Ø©)</label>
              <input type="text" id="department" name="department" value="${escapeHtml(data.department || '')}">
            </div>
          `}
        </div>
        
        <div class="form-row">
          <div class="field">
            <label for="img">Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©</label>
            <input type="url" id="img" name="img" value="${escapeHtml(data.img || '')}">
          </div>
          <div class="field">
            <label for="map">Ø±Ø§Ø¨Ø· Ø§Ù„Ø®Ø±ÙŠØ·Ø©</label>
            <input type="url" id="map" name="map" value="${escapeHtml(data.map || '')}">
          </div>
        </div>
        
        ${tableName === 'emergency' ? `
          <div class="field">
            <label>
              <input type="checkbox" id="open24" name="open24" ${data.open24 ? 'checked' : ''}>
              ÙŠØ¹Ù…Ù„ 24 Ø³Ø§Ø¹Ø©
            </label>
          </div>
        ` : ''}
        
        <div class="field">
          <label for="description">Ø§Ù„ÙˆØµÙ</label>
          <textarea id="description" name="description">${escapeHtml(data.description || '')}</textarea>
        </div>
      `;
      
    case 'blog':
      return `
        <div class="field">
          <label for="title">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‚Ø§Ù„ *</label>
          <input type="text" id="title" name="title" value="${escapeHtml(data.title || '')}" required>
        </div>
        
        <div class="form-row">
          <div class="field">
            <label for="excerpt">Ù…Ù‚ØªØ·Ù</label>
            <input type="text" id="excerpt" name="excerpt" value="${escapeHtml(data.excerpt || '')}">
          </div>
          <div class="field">
            <label for="img">Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©</label>
            <input type="url" id="img" name="img" value="${escapeHtml(data.img || '')}">
          </div>
        </div>
        
        <div class="field">
          <label for="content">Ø§Ù„Ù…Ø­ØªÙˆÙ‰</label>
          <textarea id="content" name="content" style="min-height: 200px;">${escapeHtml(data.content || '')}</textarea>
        </div>
      `;
      
    default:
      return '<p>Ù†Ù…ÙˆØ°Ø¬ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ</p>';
  }
}

function generateDayFields(schedule = {}) {
  const days = [
    { key: 'saturday', label: 'Ø§Ù„Ø³Ø¨Øª' },
    { key: 'sunday', label: 'Ø§Ù„Ø£Ø­Ø¯' },
    { key: 'monday', label: 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†' },
    { key: 'tuesday', label: 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡' },
    { key: 'wednesday', label: 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡' },
    { key: 'thursday', label: 'Ø§Ù„Ø®Ù…ÙŠØ³' },
    { key: 'friday', label: 'Ø§Ù„Ø¬Ù…Ø¹Ø©' }
  ];
  
  return days.map(day => `
    <div class="day-field">
      <label style="font-weight:700;margin-bottom:6px">${day.label}</label>
      <input type="text" name="schedule_${day.key}" 
             value="${escapeHtml((schedule[day.key] && schedule[day.key].time) || '')}" 
             placeholder="Ù…Ø«Ø§Ù„: 8 Øµ - 2 Ù…">
    </div>
  `).join('');
}

// Handle Modal Submission
modalForm.addEventListener('submit', async (e) => {
  e.preventDefault();
  
  if (!editing || !editing.collection) {
    showAlert('Ø­Ø§Ù„Ø© ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØ©', 'error');
    return;
  }
  
  const formData = new FormData(modalForm);
  const collection = editing.collection;
  
  try {
    let data = {};
    
    switch (collection) {
      case 'doctors':
        data = {
          name: (formData.get('name') || '').trim(),
          specialty: (formData.get('specialty') || '').trim(),
          hospital: (formData.get('hospital') || '').trim(),
          phone: (formData.get('phone') || '').trim(),
          img: (formData.get('img') || '').trim(),
          notes: (formData.get('notes') || '').trim(),
          schedule: {}
        };
        
        // Add schedule
        const days = ['saturday', 'sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday'];
        days.forEach(day => {
          data.schedule[day] = {
            time: (formData.get(`schedule_${day}`) || '').trim()
          };
        });
        break;
        
      case 'hospitals':
      case 'clinics':
      case 'labs':
      case 'emergency':
        data = {
          name: (formData.get('name') || '').trim(),
          city: (formData.get('city') || '').trim(),
          phone: (formData.get('phone') || '').trim(),
          img: (formData.get('img') || '').trim(),
          map: (formData.get('map') || '').trim(),
          description: (formData.get('description') || '').trim()
        };
        
        if (collection === 'labs') {
          data.tests = (formData.get('tests') || '').trim();
        } else {
          data.department = (formData.get('department') || '').trim();
        }
        
        if (collection === 'emergency') {
          data.open24 = formData.get('open24') === 'on';
        }
        break;
        
      case 'blog':
        data = {
          title: (formData.get('title') || '').trim(),
          excerpt: (formData.get('excerpt') || '').trim(),
          img: (formData.get('img') || '').trim(),
          content: (formData.get('content') || '').trim()
        };
        break;
    }
    
    // Remove empty fields
    Object.keys(data).forEach(key => {
      if (data[key] === '' || data[key] === null || data[key] === undefined) {
        delete data[key];
      }
    });
    
    // Add/update timestamp
    if (!editing.id) {
      data.created_at = new Date().toISOString();
    }
    
    // Save to Supabase
    let result;
    if (editing.id) {
      result = await supabase
        .from(collection)
        .update(data)
        .eq('id', editing.id);
    } else {
      result = await supabase
        .from(collection)
        .insert([data]);
    }
    
    if (result.error) throw result.error;
    
    showAlert(editing.id ? 'ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­' : 'ØªÙ… Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¬Ø§Ø­', 'success');
    
    // Close modal and refresh data
    closeModal();
    loadTableData(collection);
    loadStatistics();
    
  } catch (error) {
    console.error('Error saving data:', error);
    showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸: ' + (error.message || 'Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'), 'error');
  }
});

// Close Modal
btnCancel.addEventListener('click', closeModal);
overlay.addEventListener('click', (e) => {
  if (e.target === overlay) closeModal();
});

function closeModal() {
  overlay.classList.remove('show');
  formFields.innerHTML = '';
  editing = null;
  if (btnSave) btnSave.style.display = '';
}

// Logout Function
window.logoutDashboard = async function() {
  if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')) {
    try {
      const { error } = await supabase.auth.signOut();
      if (error) throw error;
      
      localStorage.removeItem('supabase_auth_token');
      localStorage.removeItem('adminEmail');
      window.location.href = 'login.html';
    } catch (error) {
      console.error('Logout error:', error);
      showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬', 'error');
    }
  }
};

// Initialize Dashboard
async function initDashboard() {
  try {
    // Check authentication
    const session = await checkAuth();
    if (!session) {
      window.location.href = 'login.html';
      return;
    }
    
    // Set user info
    document.getElementById('userName').textContent = session.user.email || 'Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…';
    document.getElementById('userRole').textContent = 'Ù…Ø³Ø¤ÙˆÙ„';
    
    // Load initial data
    await loadStatistics();
    setupSearch();
    
    // Set initial navigation
    navigateTo('dashboard');
    
  } catch (error) {
    console.error('Dashboard initialization error:', error);
    showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…', 'error');
  }
}

// Initialize when page loads
document.addEventListener('DOMContentLoaded', initDashboard);

// Export functions to global scope for HTML onclick handlers
window.addNewItem = addNewItem;
window.viewItem = viewItem;
window.editItem = editItem;
window.deleteItem = deleteItem;
window.loadTableData = loadTableData;
</script>

</body>

</html>
