<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ğŸ¥ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ©</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
:root {
  --primary: #009688;
  --primary-dark: #00695C;
  --secondary: #00796B;
  --light-bg: #eef3f3;
  --card-bg: #ffffff;
  --text-dark: #333;
  --text-light: #666;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: 'Cairo', sans-serif;
}

body {
  background: linear-gradient(135deg, #f0f7f7 0%, #e0f2f1 100%);
  min-height: 100vh;
  display: flex;
  justify-content: center;
  padding: 20px 0;
}

.container {
  width: 100%;
  max-width: 420px;
  padding: 0 15px;
}

/* ===== Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹ ===== */
.back-btn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  background: var(--primary-dark);
  color: white;
  padding: 10px 16px;
  border-radius: 12px;
  text-decoration: none;
  margin-bottom: 20px;
  font-weight: 600;
  font-size: 15px;
  transition: all 0.3s ease;
  box-shadow: 0 4px 12px rgba(0, 105, 92, 0.2);
}

.back-btn:hover {
  background: var(--primary);
  transform: translateY(-2px);
  box-shadow: 0 6px 18px rgba(0, 105, 92, 0.3);
}

/* ===== Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ===== */
.page-header {
  text-align: center;
  margin-bottom: 25px;
  padding: 15px 0;
}


.page-header h1::after {
  content: '';
  position: absolute;
  bottom: -5px;
  left: 50%;
  transform: translateX(-50%);
  width: 100px;
  height: 3px;
  background: linear-gradient(90deg, var(--primary), var(--secondary));
  border-radius: 3px;
}

.page-header p {
  color: var(--text-light);
  font-size: 15px;
}

/* ===== Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« ===== */
.search-container {
  position: relative;
  margin-bottom: 25px;
}

.search-box {
  width: 100%;
  padding: 16px 20px 16px 50px;
  border-radius: 15px;
  border: 2px solid rgba(0, 150, 136, 0.2);
  background: white;
  font-size: 16px;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(0, 105, 92, 0.1);
}

.search-box:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 4px 20px rgba(0, 150, 136, 0.3);
}

.search-box::placeholder {
  color: #999;
}

.search-icon {
  position: absolute;
  right: 18px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--primary);
  font-size: 18px;
}

/* ===== Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ===== */
.stats-bar {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 12px;
  margin-bottom: 25px;
}

.stat-item {
  background: white;
  padding: 15px;
  border-radius: 12px;
  text-align: center;
  box-shadow: 0 4px 15px rgba(0, 105, 92, 0.1);
  border: 1px solid rgba(0, 150, 136, 0.1);
  transition: all 0.3s ease;
}

.stat-item:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 20px rgba(0, 105, 92, 0.15);
}

.stat-item i {
  font-size: 22px;
  margin-bottom: 8px;
  color: var(--primary);
}

.stat-item .count {
  font-size: 24px;
  font-weight: 800;
  display: block;
  margin: 5px 0;
  color: var(--primary-dark);
}

.stat-item .label {
  font-size: 13px;
  color: var(--text-light);
}

/* ===== Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø®ØªØ¨Ø± ===== */
.labs-container {
  display: grid;
  gap: 20px;
  margin-bottom: 30px;
}

.lab-card {
  background: white;
  padding: 22px;
  border-radius: 18px;
  box-shadow: 0 6px 25px rgba(0, 105, 92, 0.1);
  border: 1px solid rgba(0, 150, 136, 0.1);
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
  animation: fadeIn 0.5s ease;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

.lab-card:hover {
  transform: translateY(-8px);
  box-shadow: 0 12px 35px rgba(0, 105, 92, 0.2);
  border-color: rgba(0, 150, 136, 0.3);
}

.lab-card::before {
  content: '';
  position: absolute;
  top: 0;
  right: 0;
  width: 5px;
  height: 100%;
  background: linear-gradient(to bottom, var(--primary), var(--secondary));
}

.lab-img {
  width: 100px;
  height: 100px;
  border-radius: 50%;
  object-fit: cover;
  margin: 0 auto 18px auto;
  border: 4px solid white;
  box-shadow: 0 4px 20px rgba(0, 105, 92, 0.2);
  display: block;
  transition: all 0.3s ease;
}

.lab-card:hover .lab-img {
  transform: scale(1.08);
  box-shadow: 0 8px 30px rgba(0, 105, 92, 0.3);
}

.lab-header {
  text-align: center;
  margin-bottom: 18px;
  padding-bottom: 12px;
  border-bottom: 1px solid rgba(0, 150, 136, 0.1);
}

.lab-header h3 {
  font-size: 20px;
  font-weight: 800;
  color: var(--primary-dark);
  margin-bottom: 5px;
}

.lab-type {
  display: inline-block;
  padding: 5px 15px;
  background: rgba(0, 150, 136, 0.1);
  color: var(--primary);
  border-radius: 20px;
  font-size: 13px;
  font-weight: 600;
}

.lab-info {
  display: grid;
  gap: 12px;
  margin-bottom: 20px;
}

.info-row {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px;
  background: rgba(0, 150, 136, 0.03);
  border-radius: 10px;
  border: 1px solid rgba(0, 150, 136, 0.05);
}

.info-row i {
  font-size: 16px;
  color: var(--primary);
  width: 22px;
  text-align: center;
}

.info-row div {
  flex: 1;
}

.info-row strong {
  display: block;
  font-size: 13px;
  color: var(--text-light);
  margin-bottom: 3px;
}

.info-row span {
  font-size: 15px;
  color: var(--text-dark);
  font-weight: 600;
}

/* ===== Ø²Ø± Ø§Ù„ØªÙØ§ØµÙŠÙ„ ===== */
.details-btn {
  display: block;
  width: 100%;
  padding: 14px;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  color: white;
  text-decoration: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 700;
  text-align: center;
  transition: all 0.3s ease;
  border: none;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
}

.details-btn:hover {
  background: linear-gradient(135deg, var(--secondary), var(--primary));
  transform: translateY(-3px);
  box-shadow: 0 8px 25px rgba(0, 150, 136, 0.3);
}

.details-btn i {
  font-size: 18px;
}

/* ===== Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ ===== */
.loading {
  text-align: center;
  padding: 50px 20px;
  color: var(--text-light);
  font-size: 18px;
}

.loading i {
  font-size: 32px;
  margin-bottom: 20px;
  display: block;
  color: var(--primary);
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* ===== Ø­Ø§Ù„Ø© ÙØ§Ø±ØºØ© ===== */
.empty-state {
  text-align: center;
  padding: 60px 20px;
  color: var(--text-light);
}

.empty-state i {
  font-size: 50px;
  margin-bottom: 20px;
  color: #ccc;
  display: block;
}

.empty-state p {
  font-size: 16px;
  margin-bottom: 10px;
}

/* ===== Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù„Ø¬ÙˆØ§Ù„ ===== */
@media (max-width: 480px) {
  .container {
    padding: 0 10px;
  }
  
  .page-header h1 {
    font-size: 24px;
  }
  
  .lab-img {
    width: 85px;
    height: 85px;
  }
  
  .lab-card {
    padding: 18px;
  }
  
  .stats-bar {
    grid-template-columns: 1fr;
  }
}

@media (max-width: 350px) {
  .page-header h1 {
    font-size: 22px;
  }
  
  .search-box {
    padding: 14px 16px 14px 45px;
  }
  
  .lab-img {
    width: 75px;
    height: 75px;
  }
}
</style>
</head>

<body>

<div class="container">
  
  <!-- Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹ -->
  <a href="branches.html" class="back-btn">
    <i class="fas fa-arrow-right"></i>
    Ø±Ø¬ÙˆØ¹
  </a>
  
  <!-- Ø§Ù„Ø¹Ù†ÙˆØ§Ù† -->
  <div class="page-header">
    <h1>ğŸ¥ Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ©</h1>
    <p>Ù…Ø®ØªØ¨Ø±Ø§Øª Ù…Ø¹ØªÙ…Ø¯Ø© Ø¨Ù…ÙˆØ§ØµÙØ§Øª Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø¬ÙˆØ¯Ø©</p>
  </div>
  
  <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« -->
  <div class="search-container">
    <input type="text" id="search" class="search-box" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ø®ØªØ¨Ø± Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©...">
    <i class="fas fa-search search-icon"></i>
  </div>
  
  <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
  <div class="stats-bar" id="statsContainer">
    <div class="stat-item">
      <i class="fas fa-flask"></i>
      <span class="count" id="totalLabs">0</span>
      <span class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª</span>
    </div>
    <div class="stat-item">
      <i class="fas fa-map-marker-alt"></i>
      <span class="count" id="totalCities">0</span>
      <span class="label">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¯Ù†</span>
    </div>
    <div class="stat-item">
      <i class="fas fa-phone"></i>
      <span class="count" id="availableLabs">0</span>
      <span class="label">Ù…ØªØ§Ø­Ø© Ù„Ù„Ø§ØªØµØ§Ù„</span>
    </div>
    <div class="stat-item">
      <i class="fas fa-star"></i>
      <span class="count" id="ratedLabs">0</span>
      <span class="label">Ù…Ø®ØªØ¨Ø±Ø§Øª Ù…ØµÙ†ÙØ©</span>
    </div>
  </div>
  
  <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª -->
  <div id="labs" class="loading">
    <i class="fas fa-spinner"></i>
    <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª...</p>
  </div>
  
</div>

<script type="module">
// Ø§Ø³ØªÙŠØ±Ø§Ø¯ Supabase
import { supabase } from './supabase.js';

// Ø¹Ù†Ø§ØµØ± DOM
const labsContainer = document.getElementById('labs');
const searchInput = document.getElementById('search');
const stats = {
  total: document.getElementById('totalLabs'),
  cities: document.getElementById('totalCities'),
  available: document.getElementById('availableLabs'),
  rated: document.getElementById('ratedLabs')
};

// Ù…ØªØºÙŠØ±Ø§Øª
let allLabs = [];

// Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
function updateStatistics(labs) {
  const total = labs.length;
  const cities = [...new Set(labs.map(l => l.city).filter(Boolean))];
  const available = labs.filter(l => l.phone && l.phone.trim() !== '' && l.phone !== 'Ù„Ø§ ÙŠÙˆØ¬Ø¯').length;
  const rated = labs.filter(l => l.rating && parseFloat(l.rating) > 0).length;

  stats.total.textContent = total;
  stats.cities.textContent = cities.length;
  stats.available.textContent = available;
  stats.rated.textContent = rated;
}

// Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª
function renderLabs(labs) {
  if (!labs || labs.length === 0) {
    labsContainer.innerHTML = `
      <div class="empty-state">
        <i class="fas fa-flask"></i>
        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø®ØªØ¨Ø±Ø§Øª ${searchInput.value ? `Ø¨Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø¨Ø­Ø«: "${searchInput.value}"` : ''}</p>
        <p style="font-size: 14px; color: #999;">Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ù…Ø®ØªØ¨Ø±Ø§Øª Ù‚Ø±ÙŠØ¨Ø§Ù‹</p>
      </div>
    `;
    return;
  }
  
  let html = '<div class="labs-container">';
  
  labs.forEach(lab => {
    const { id, name, city, phone, img, type, rating, description } = lab;
    
    // ØµÙˆØ±Ø© Ø§Ù„Ù…Ø®ØªØ¨Ø±
    const imgSrc = img && img.trim() !== "" 
      ? img 
      : "https://images.unsplash.com/photo-1559757148-5c350d0d3c56?w=400&h=400&fit=crop";
    
    // Ù†ÙˆØ¹ Ø§Ù„Ù…Ø®ØªØ¨Ø±
    const labType = type || 'Ø·Ø¨ÙŠ';
    
    // ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†Ø¬ÙˆÙ…
    let starsHtml = '';
    const ratingNum = parseFloat(rating) || 0;
    for (let i = 1; i <= 5; i++) {
      if (i <= Math.floor(ratingNum)) {
        starsHtml += '<i class="fas fa-star" style="color: #FFD700; font-size: 12px;"></i>';
      } else if (i === Math.ceil(ratingNum) && ratingNum % 1 >= 0.5) {
        starsHtml += '<i class="fas fa-star-half-alt" style="color: #FFD700; font-size: 12px;"></i>';
      } else {
        starsHtml += '<i class="far fa-star" style="color: #FFD700; font-size: 12px;"></i>';
      }
    }
    
    html += `
      <div class="lab-card" id="lab-${id}">
        <img class="lab-img" src="${imgSrc}" alt="${name}" loading="lazy">
        
        <div class="lab-header">
          <h3>${name}</h3>
          <span class="lab-type">${labType}</span>
        </div>
        
        <div class="lab-info">
          <div class="info-row">
            <i class="fas fa-map-marker-alt"></i>
            <div>
              <strong>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</strong>
              <span>${city || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
            </div>
          </div>
          
          <div class="info-row">
            <i class="fas fa-phone"></i>
            <div>
              <strong>Ø§Ù„Ù‡Ø§ØªÙ</strong>
              <span>${phone || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}</span>
            </div>
          </div>
          
          ${ratingNum > 0 ? `
            <div class="info-row">
              <i class="fas fa-star"></i>
              <div>
                <strong>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</strong>
                <span>${ratingNum} ${starsHtml}</span>
              </div>
            </div>
          ` : ''}
          
          ${description ? `
            <div class="info-row" style="grid-column: 1 / -1;">
              <i class="fas fa-file-alt"></i>
              <div>
                <strong>ÙˆØµÙ Ù…Ø®ØªØµØ±</strong>
                <span style="font-size: 14px; line-height: 1.5;">${description.substring(0, 100)}${description.length > 100 ? '...' : ''}</span>
              </div>
            </div>
          ` : ''}
        </div>
        
        <a href="lab.html?id=${id}" class="details-btn">
          <i class="fas fa-eye"></i> Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„
        </a>
      </div>
    `;
  });
  
  html += '</div>';
  labsContainer.innerHTML = html;
}

// Ø¯Ø§Ù„Ø© Ù„Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØµÙÙŠØ©
function filterLabs() {
  let filtered = [...allLabs];
  
  // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¨Ø­Ø«
  const searchTerm = searchInput.value.trim().toLowerCase();
  if (searchTerm) {
    filtered = filtered.filter(lab => 
      (lab.name && lab.name.toLowerCase().includes(searchTerm)) ||
      (lab.city && lab.city.toLowerCase().includes(searchTerm)) ||
      (lab.type && lab.type.toLowerCase().includes(searchTerm)) ||
      (lab.description && lab.description.toLowerCase().includes(searchTerm))
    );
  }
  
  renderLabs(filtered);
  updateStatistics(filtered);
}

// Ø¯Ø§Ù„Ø© Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª Ù…Ù† Supabase
async function loadLabs() {
  labsContainer.innerHTML = '<div class="loading"><i class="fas fa-spinner"></i><p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª...</p></div>';
  
  try {
    const { data: labs, error } = await supabase
      .from('labs')
      .select('*')
      .order('name', { ascending: true });
    
    if (error) throw error;
    
    console.log(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${labs?.length || 0} Ù…Ø®ØªØ¨Ø±`);
    allLabs = labs || [];
    
    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„Ø§ØªØ± ÙˆØ§Ù„Ø¹Ø±Ø¶
    filterLabs();
    
  } catch (error) {
    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª:', error);
    labsContainer.innerHTML = `
      <div class="empty-state">
        <i class="fas fa-exclamation-triangle"></i>
        <p>Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª</p>
        <p style="font-size: 14px; color: #e74c3c;">${error.message}</p>
        <button onclick="loadLabs()" style="margin-top: 15px; padding: 10px 20px; background: var(--primary); border: none; border-radius: 10px; color: white; cursor: pointer; font-weight: 600;">
          <i class="fas fa-redo"></i> Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©
        </button>
      </div>
    `;
  }
}

// =========================
// ğŸš€ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
// =========================
async function init() {
  console.log('ğŸš€ Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ ØµÙØ­Ø© Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª...');
  
  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª Ø£ÙˆÙ„ Ù…Ø±Ø©
  await loadLabs();
  
  // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨Ø­Ø«
  searchInput.addEventListener('input', () => {
    filterLabs();
  });
  
  // Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ø§Ù„Ø¨Ø­Ø«
  searchInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
      filterLabs();
    }
  });
  
  // Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©
  const channel = supabase
    .channel('realtime-labs')
    .on(
      'postgres_changes',
      {
        event: '*',
        schema: 'public',
        table: 'labs'
      },
      () => {
        loadLabs();
      }
    )
    .subscribe((status) => {
      console.log('ğŸ“¡ Ø­Ø§Ù„Ø© Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª:', status);
    });
  
  // ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©
  setInterval(() => {
    loadLabs();
  }, 60000);
  
  console.log('âœ… ØªÙ… ØªÙ‡ÙŠØ¦Ø© ØµÙØ­Ø© Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
}

// Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
init();

// Ø¬Ø¹Ù„ Ø§Ù„Ø¯Ø§Ù„Ø© Ù…ØªØ§Ø­Ø© Ù„Ù„Ø²Ø±
window.loadLabs = loadLabs;
</script>

</body>
</html> 