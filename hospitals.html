<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ´ÙÙŠØ§Øª</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Ø±Ø¤ÙˆØ³ Ø£Ù…Ø§Ù† HTTP -->
<meta http-equiv="Content-Security-Policy" content="
  default-src 'self';
  script-src 'self' 'unsafe-inline' https://esm.sh;
  style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
  font-src 'self' https://fonts.gstatic.com;
  img-src 'self' data: https:;
  connect-src 'self' https://gxuumjhtutkipvkljjhj.supabase.co;
  frame-ancestors 'self';
">
<meta http-equiv="X-Content-Type-Options" content="nosniff">
<meta http-equiv="X-Frame-Options" content="DENY">
<meta http-equiv="X-XSS-Protection" content="1; mode=block">
<meta name="referrer" content="strict-origin-when-cross-origin">

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap" rel="stylesheet">

<style>
  * { 
    margin:0; padding:0; box-sizing:border-box;
    font-family:'Cairo', sans-serif;
  }

  body {
    background:#eef3f3;
    display:flex;
    justify-content:center;
    padding:0;
  }

  .container {
    width:100%;
    max-width:380px;
    padding:12px;
  }

  .back-btn{
    display:inline-block;
    background:#444;
    color:#fff;
    padding:8px 14px;
    border-radius:10px;
    text-decoration:none;
    font-size:15px;
    margin-bottom:12px;
  }

  h1 {
    text-align:center;
    color:#00695C;
    margin-bottom:15px;
    font-size:22px;
    font-weight:800;
  }

  .card {
    background:white;
    width:100%;
    padding:16px;
    border-radius:14px;
    margin-bottom:14px;
    box-shadow:0 3px 10px rgba(0,0,0,0.10);
    transition:0.2s;
  }

  .card:hover { transform:translateY(-3px); }

  .hospital-name {
    font-size:19px;
    font-weight:800;
    color:#00695C;
    margin-bottom:8px;
  }

  .info {
    color:#333;
    font-size:15px;
    margin-bottom:4px;
  }

  .info b {
    color:#004D40;
  }

  .btn {
    display:block;
    width:100%;
    padding:10px;
    margin-top:10px;
    background:#00796B;
    color:white;
    text-align:center;
    font-size:15px;
    border-radius:10px;
    text-decoration:none;
    font-weight:600;
  }

  .hospital-imgcircle {
    width: 90px;
    height: 90px;
    border-radius: 50%;
    object-fit: cover;
    display: block;
    margin: 0 auto 10px auto;
    border: 3px solid #009688;
  }

  .loading {
    text-align: center;
    padding: 30px;
    color: #666;
  }

  .error {
    text-align: center;
    padding: 20px;
    color: #d32f2f;
    background: #ffebee;
    border-radius: 10px;
    margin: 10px 0;
  }

  .empty-state {
    text-align: center;
    padding: 40px 20px;
    color: #666;
  }

  .empty-state i {
    font-size: 48px;
    color: #ccc;
    margin-bottom: 15px;
    display: block;
  }
</style>
</head>

<body>

<div class="container">
  <a href="index.html" class="back-btn">â¬… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
  <h1>ğŸ¥ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ´ÙÙŠØ§Øª</h1>
  <div id="hospitals">
    <div class="loading">
      <i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ´ÙÙŠØ§Øª...
    </div>
  </div>
</div>

<!-- Ø¥Ø¶Ø§ÙØ© Font Awesome Ù…Ù† CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>

<script type="module">
import { supabase } from "./supabase.js";

// Ø¯Ø§Ù„Ø© Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø·Ø§Ù‚Ø© Ù…Ø³ØªØ´ÙÙ‰
function createHospitalCard(hospital) {
  const card = document.createElement('div');
  card.className = 'card';
  
  // ØµÙˆØ±Ø© Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰
  const img = document.createElement('img');
  img.className = 'hospital-imgcircle';
  img.src = hospital.img || 'https://i.postimg.cc/TPZpYH5f/noimage.png';
  img.alt = hospital.name || 'ØµÙˆØ±Ø© Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰';
  img.loading = 'lazy'; // ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡
  
  // Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰
  const nameDiv = document.createElement('div');
  nameDiv.className = 'hospital-name';
  nameDiv.textContent = hospital.name || 'Ø§Ø³Ù… ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
  
  // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰
  const cityInfo = document.createElement('p');
  cityInfo.className = 'info';
  const cityBold = document.createElement('b');
  cityBold.textContent = 'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©: ';
  cityInfo.appendChild(cityBold);
  cityInfo.appendChild(document.createTextNode(hospital.city || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'));
  
  const phoneInfo = document.createElement('p');
  phoneInfo.className = 'info';
  const phoneBold = document.createElement('b');
  phoneBold.textContent = 'Ø§Ù„Ù‡Ø§ØªÙ: ';
  phoneInfo.appendChild(phoneBold);
  phoneInfo.appendChild(document.createTextNode(hospital.phone || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'));
  
  const deptInfo = document.createElement('p');
  deptInfo.className = 'info';
  const deptBold = document.createElement('b');
  deptBold.textContent = 'Ø§Ù„Ø£Ù‚Ø³Ø§Ù…: ';
  deptInfo.appendChild(deptBold);
  deptInfo.appendChild(document.createTextNode(hospital.department || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'));
  
  const descInfo = document.createElement('p');
  descInfo.className = 'info';
  const descBold = document.createElement('b');
  descBold.textContent = 'Ø§Ù„ÙˆØµÙ: ';
  descInfo.appendChild(descBold);
  descInfo.appendChild(document.createTextNode(hospital.description || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ'));
  
  // Ø²Ø± Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„
  const link = document.createElement('a');
  link.className = 'btn';
  link.href = `hospital.html?id=${hospital.id}`;
  link.textContent = 'Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„';
  
  // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ±
  card.appendChild(img);
  card.appendChild(nameDiv);
  card.appendChild(cityInfo);
  card.appendChild(phoneInfo);
  card.appendChild(deptInfo);
  card.appendChild(descInfo);
  card.appendChild(link);
  
  return card;
}

// Ø¯Ø§Ù„Ø© Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ´ÙÙŠØ§Øª
async function loadHospitals() {
  const container = document.getElementById('hospitals');
  
  try {
    const { data, error } = await supabase
      .from("hospitals") 
      .select("*")
      .order('name', { ascending: true });
    
    // ØªÙØ±ÙŠØº Ø§Ù„Ø­Ø§ÙˆÙŠØ©
    while (container.firstChild) {
      container.removeChild(container.firstChild);
    }
    
    if (error) {
      const errorDiv = document.createElement('div');
      errorDiv.className = 'error';
      errorDiv.textContent = 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ´ÙÙŠØ§Øª. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹.';
      container.appendChild(errorDiv);
      console.error('Ø®Ø·Ø£ Supabase:', error);
      return;
    }
    
    if (!data || data.length === 0) {
      const emptyDiv = document.createElement('div');
      emptyDiv.className = 'empty-state';
      
      const icon = document.createElement('i');
      icon.className = 'fas fa-hospital';
      
      const message = document.createElement('p');
      message.textContent = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø³ØªØ´ÙÙŠØ§Øª Ù…Ø³Ø¬Ù„Ø© Ø­Ø§Ù„ÙŠØ§Ù‹';
      
      emptyDiv.appendChild(icon);
      emptyDiv.appendChild(message);
      container.appendChild(emptyDiv);
      return;
    }
    
    // Ø¥Ø¶Ø§ÙØ© ÙƒÙ„ Ù…Ø³ØªØ´ÙÙ‰
    data.forEach(hospital => {
      const card = createHospitalCard(hospital);
      container.appendChild(card);
    });
    
  } catch (err) {
    console.error('Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹:', err);
    
    const errorDiv = document.createElement('div');
    errorDiv.className = 'error';
    errorDiv.textContent = 'Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹. ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©.';
    
    while (container.firstChild) {
      container.removeChild(container.firstChild);
    }
    container.appendChild(errorDiv);
  }
}

// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
document.addEventListener('DOMContentLoaded', () => {
  loadHospitals();
  
  // ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
  setInterval(() => {
    loadHospitals();
  }, 60000);
});

// Ø¯Ø§Ù„Ø© Ø¥Ø¶Ø§ÙÙŠØ©: Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø³ØªØ´ÙÙŠØ§Øª (Ø¥Ø°Ø§ Ø£Ø±Ø¯Øª Ø¥Ø¶Ø§ÙØ© Ø¨Ø­Ø« Ù„Ø§Ø­Ù‚Ø§Ù‹)
function setupSearch() {
  // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø´Ø±ÙŠØ· Ø¨Ø­Ø« Ù‡Ù†Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹
  console.log('Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨Ø­Ø« - Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¥Ø¶Ø§ÙØ©');
}
</script>

</body>
</html>
