<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… 2</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Cairo',sans-serif;}
body{
  background:linear-gradient(135deg, #0a0a0a, #111, #1a1a1a, #222);
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  color:white;
  padding:20px;
}
.container{ width:100%; max-width:800px; text-align:center; }

#loading-screen, #main-content { display:none; }
.main-wrapper{ flex:1; display:flex; flex-direction:column; align-items:center; text-align:center; padding:30px 10px; }
header h1{ font-size:38px; font-weight:800; margin-bottom:10px; }
header p{ font-size:20px; opacity:.9; margin-bottom:25px; }
.cards{ width:100%; max-width:600px; display:flex; flex-direction:column; gap:18px; }
.card{
  background:rgba(255,255,255,0.07);
  padding:20px;
  border-radius:16px;
  text-align:center;
  backdrop-filter:blur(5px);
  box-shadow:0 6px 18px rgba(0,0,0,0.45);
  transition:0.25s;
  cursor:pointer;
}
.card:hover{ background:rgba(255,255,255,0.12); transform:scale(1.03); }
.card-title{ font-size:24px; font-weight:800; margin-bottom:6px; }
.card-value{ font-size:18px; margin-bottom:14px; opacity:.95; }
.logout-btn{
  background:#ff4c4c;
  padding:12px 20px;
  border-radius:12px;
  text-align:center;
  color:white;
  font-weight:800;
  width:100%;
  max-width:600px;
  margin-top:20px;
  cursor:pointer;
  transition:0.2s;
}
.logout-btn:hover{ background:#ff6b6b; }
footer{ text-align:center; opacity:.9; font-size:18px; padding:15px 10px; margin-top:25px; }
</style>
</head>
<body>
<div class="container">

  <!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
  <div id="loading-screen">
    <div class="spinner" style="width:70px;height:70px;border:6px solid rgba(255,255,255,0.1);border-top-color:#4cd964;border-radius:50%;animation:spin 1s linear infinite;margin-bottom:25px;"></div>
    <div class="loading-text" style="font-size:22px;font-weight:700;color:white;margin-bottom:10px;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø¯Ø®ÙˆÙ„...</div>
    <div class="loading-subtext" style="font-size:16px;opacity:0.7;color:#aaa;">Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</div>
  </div>

  <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
  <div id="main-content">
    <div class="main-wrapper">
      <header>
        <h1>âš™ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… 2</h1>
        <div id="user-info" style="font-size:20px; opacity:.9; margin-bottom:25px;">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…...</div>
      </header>

      <div class="cards">
        <div class="card" onclick="goToPage('dashboard-alerts.html')">
          <div class="card-title">ğŸ”” Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</div>
          <div class="card-value">Ø¥Ø¶Ø§ÙØ© â€“ ØªØ¹Ø¯ÙŠÙ„ â€“ Ø­Ø°Ù</div>
        </div>
        <div class="card" onclick="goToPage('dashboard-reasons.html')">
          <div class="card-title">âš¡ Ø¥Ø¯Ø§Ø±Ø© Ø£Ø³Ø¨Ø§Ø¨ Ø§Ù„Ø§Ù†Ù‚Ø·Ø§Ø¹</div>
          <div class="card-value">Ø¹Ø±Ø¶ â€“ ØªØ¹Ø¯ÙŠÙ„ â€“ Ø­Ø°Ù</div>
        </div>
        <div class="card" onclick="goToPage('dashboard-schedule.html')">
          <div class="card-title">ğŸ“… Ø¥Ø¯Ø§Ø±Ø© Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ´ØºÙŠÙ„</div>
          <div class="card-value">ØªØ´ØºÙŠÙ„ â€“ Ø§Ù†Ø·ÙØ§Ø¡ â€“ ØªØ­Ø¯ÙŠØ«</div>
        </div>
        <div class="card" onclick="goToPage('dashboard-reports.html')">
          <div class="card-title">ğŸ“¢ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª</div>
          <div class="card-value">Ø§Ù„Ø±Ø¯ â€“ ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø© â€“ Ø­Ø°Ù</div>
        </div>
      </div>

      <div class="logout-btn" id="logoutBtn">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</div>

      <footer>
        <p>Ù…/Ù…Ø§Ø¬Ø¯ Ù‚Ø§Ø³Ù… Ø­Ø³Ù† Ù…Ø¨Ø§Ø±Ùƒ Ø¨Ù† Ø¹Ù…Ø±Ùˆ</p>
        Â© 2025 â€“ Ù…Ù†ØµØ© ÙƒÙ‡Ø±Ø¨Ø§Ø¡ Ø¹ØªÙ‚
      </footer>
    </div>
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const SUPABASE_URL = "https://gxuumjhtutkipvkljjhj.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...";
const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

const loadingScreen = document.getElementById('loading-screen');
const mainContent = document.getElementById('main-content');
const userInfoElem = document.getElementById('user-info');
const logoutBtn = document.getElementById('logoutBtn');

function goToPage(url){ window.location.href = url; }

async function checkSession(){
  loadingScreen.style.display = 'flex';
  mainContent.style.display = 'none';

  const { data: { session } } = await supabase.auth.getSession();

  // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ session â†’ Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ¬ÙŠÙ‡ Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ù„Ù€ login
  if(!session){
    window.location.href = 'login1.html';
    return;
  }

  // ÙŠÙˆØ¬Ø¯ session â†’ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­ØªÙˆÙ‰
  loadingScreen.style.display = 'none';
  mainContent.style.display = 'block';
  const user = session.user;
  userInfoElem.innerHTML = `
    Ù…Ø±Ø­Ø¨Ø§Ù‹ <strong style="color:#4cd964">${user.user_metadata?.name || user.email}</strong>
    <div style="font-size:16px; opacity:0.7;">Ø§Ù„Ø¨Ø±ÙŠØ¯: ${user.email}</div>
  `;
}

// Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
logoutBtn.addEventListener('click', async () => {
  if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')){
    await supabase.auth.signOut();
    window.location.href = 'login1.html';
  }
});

// Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© â†’ ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¬Ù„Ø³Ø© ÙÙˆØ±Ø§Ù‹
document.addEventListener('DOMContentLoaded', checkSession);

// Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø¶Ø¯ Ø§Ù„Ø±Ø¬ÙˆØ¹ Ø£Ùˆ Ø§Ù„ÙƒØ§Ø´
window.addEventListener('pageshow', function(event) {
  if(event.persisted) checkSession();
});
history.pushState(null,null,location.href);
window.onpopstate = function(){ history.go(1); };
</script>
</body>
</html>
